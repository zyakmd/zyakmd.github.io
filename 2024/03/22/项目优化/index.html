<!-- build time:Tue Mar 26 2024 21:32:39 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><link rel="alternate" type="application/rss+xml" title="世界上只有一种真正的英雄主义，就是认清了生活的真相后还依然热爱它" href="https://zyakmd.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="世界上只有一种真正的英雄主义，就是认清了生活的真相后还依然热爱它" href="https://zyakmd.github.io/atom.xml"><link rel="alternate" type="application/json" title="世界上只有一种真正的英雄主义，就是认清了生活的真相后还依然热爱它" href="https://zyakmd.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Mysql,JAVA"><link rel="canonical" href="https://zyakmd.github.io/2024/03/22/%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96/"><title>redis使用 | ZY Blog = 世界上只有一种真正的英雄主义，就是认清了生活的真相后还依然热爱它</title><meta name="generator" content="Hexo 5.4.2"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">redis使用</h1><div class="meta"><span class="item" title="Created: 2024-03-22 17:02:14"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">Posted on</span> <time itemprop="dateCreated datePublished" datetime="2024-03-22T17:02:14+08:00">2024-03-22</time> </span><span class="item" title="Symbols count in article"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">Symbols count in article</span> <span>19k</span> <span class="text">words</span> </span><span class="item" title="Reading time"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">Reading time</span> <span>17 mins.</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">ZY Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://t.mwm.moe/fj?824020"></li><li class="item" data-background-image="https://t.mwm.moe/fj?491521"></li><li class="item" data-background-image="https://t.mwm.moe/fj?709659"></li><li class="item" data-background-image="https://t.mwm.moe/fj?1245"></li><li class="item" data-background-image="https://t.mwm.moe/fj?42114"></li><li class="item" data-background-image="https://t.mwm.moe/fj?261289"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">Home</a></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="en"><link itemprop="mainEntityOfPage" href="https://zyakmd.github.io/2024/03/22/%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="ZY"><meta itemprop="description" content=", 行到水穷处，坐看云起时"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="世界上只有一种真正的英雄主义，就是认清了生活的真相后还依然热爱它"></span><div class="body md" itemprop="articleBody"><p>最近的一次 java 项目还是本科，几年了，主从和 Nginx 有用过，虽然也忘了。但肯定不够，要躺板板的。补充学一下 Redis 和 RabbitMQ 和复习之前的。</p><h1 id="redis-springcache"><a class="anchor" href="#redis-springcache">#</a> Redis + SpringCache</h1><h2 id="安装"><a class="anchor" href="#安装">#</a> 安装</h2><p>没啥好说的，双端安装，教程很多，其中 linux 下需要 gcc 环境</p><h2 id="服务运行"><a class="anchor" href="#服务运行">#</a> 服务运行</h2><h3 id="启停"><a class="anchor" href="#启停">#</a> 启停</h3><ul><li>进入到 <code>/src</code> 目录下，执行 <code>redis-server</code> 即可启动服务，默认端口号为 <code>6379</code></li></ul><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 进入到根目录  </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token builtin class-name">cd</span> /usr/local/redis根目录/src  </pre></td></tr><tr><td data-num="3"></td><td><pre>  </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 执行 redis-server  </span></pre></td></tr><tr><td data-num="5"></td><td><pre>./redis-server</pre></td></tr></table></figure><ul><li><code>ps aux | grep redis</code> 查看当前进程 PID</li><li><code>kill -9 PID</code> 关闭</li><li>或者执行<br><code>redis-cli shutdown</code><br>有密码则要先登录再 shutdown <code>redis-cli -p &lt;password&gt; shutdown</code> ，虽然会提示直接这样用密码不安全哈哈</li></ul><h3 id="后台运行"><a class="anchor" href="#后台运行">#</a> 后台运行</h3><ul><li>进入到 redis 根目录下，修改配置 redis.conf 文件</li></ul><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 进入到 redis 根目录下  </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token builtin class-name">cd</span> /usr/local/redis根目录  </pre></td></tr><tr><td data-num="3"></td><td><pre>  </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 修改配置文件  </span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">vim</span> redis.conf</pre></td></tr></table></figure><ul><li>找到 <code>daemonize on</code> 字段，将其修改为 <code>daemonize yes</code></li><li>在 redis 根目录以 redis.conf 作为配置文件在后台运行</li></ul><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">cd</span> src/redis-server </pre></td></tr><tr><td data-num="2"></td><td><pre>./redis.conf</pre></td></tr></table></figure><ul><li>或者 tmux 开后台终端也好用</li></ul><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 虚拟环境（免断网掉线，后台运行） &#123;创建、进入、杀死、切换、重命名、显示所有&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>tmux new <span class="token parameter variable">-t</span> <span class="token operator">&lt;</span>name<span class="token operator">></span></pre></td></tr><tr><td data-num="3"></td><td><pre>tmux a <span class="token parameter variable">-t</span> <span class="token operator">&lt;</span>name<span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre>tmux kill-session <span class="token parameter variable">-t</span> <span class="token operator">&lt;</span>session-name<span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre>tmux switch <span class="token parameter variable">-t</span> <span class="token operator">&lt;</span>session-name<span class="token operator">></span></pre></td></tr><tr><td data-num="6"></td><td><pre>tmux rename-session <span class="token parameter variable">-t</span> <span class="token number">0</span> <span class="token operator">&lt;</span>new-name<span class="token operator">></span></pre></td></tr><tr><td data-num="7"></td><td><pre>tmux <span class="token function">ls</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 退出 (非终止)，在里面 Ctrl+b  按 d</span></pre></td></tr></table></figure><h3 id="密码校验"><a class="anchor" href="#密码校验">#</a> 密码校验</h3><ul><li>还是修改 redis.conf 配置文件，找到 <code>requirepass</code> 这行 (vim 里 / 查找内容)，将其注释去掉，并在后面写上自己的密码</li><li>然后杀掉原进程再重新启动</li></ul><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 重新启动  </span></pre></td></tr><tr><td data-num="2"></td><td><pre>src/redis-server ./redis.conf   </pre></td></tr><tr><td data-num="3"></td><td><pre>  </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 登录时同时进行认证  </span></pre></td></tr><tr><td data-num="5"></td><td><pre>src/redis-cli <span class="token parameter variable">-h</span> localhost <span class="token parameter variable">-p</span> <span class="token number">6379</span> <span class="token parameter variable">-a</span> <span class="token operator">&lt;</span>password<span class="token operator">></span></pre></td></tr></table></figure><ul><li>修改完毕之后重启服务</li></ul><h3 id="远程连接"><a class="anchor" href="#远程连接">#</a> 远程连接</h3><ul><li>还是修改 redis.conf 配置文件，找到 <code>bind 127.0.0.1</code> 这行，把这行注释掉</li><li>之后设置防火墙，开启 6379 端口</li></ul><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 开启 6379 端口  </span></pre></td></tr><tr><td data-num="2"></td><td><pre>firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --add-port<span class="token operator">=</span><span class="token number">6379</span>/tcp <span class="token parameter variable">--permanent</span>  </pre></td></tr><tr><td data-num="3"></td><td><pre>  </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># 设置立即生效  </span></pre></td></tr><tr><td data-num="5"></td><td><pre>firewall-cmd <span class="token parameter variable">--reload</span>  </pre></td></tr><tr><td data-num="6"></td><td><pre>  </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 查看开放的端口  </span></pre></td></tr><tr><td data-num="8"></td><td><pre>firewall-cmd <span class="token parameter variable">--zone</span><span class="token operator">=</span>public --list-ports</pre></td></tr></table></figure><ul><li>服务器对应的接口要打开，像阿里云在 esc 控制台要手动添加开放端口</li><li>最后在 Windows 的 redis 根目录下，按住 Shift + 右键打开 PowerShell 窗口，连接 Linux 的 Redis<br><code>.\redis-cli.ext -h 服务器地址 -p 6379 -a &lt;password&gt;</code></li></ul><p>懒得开控制台的话用 redis desktop，<span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0phY2FDYW8vYXJ0aWNsZS9kZXRhaWxzLzEwNjA4ODE0OA==">使用参考</span></p><h3 id="报错"><a class="anchor" href="#报错">#</a> 报错</h3><p>启动的时候遇到了</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>WARNING overcommit_memory is <span class="token builtin class-name">set</span> to <span class="token number">0</span><span class="token operator">!</span> Background save may fail</pre></td></tr><tr><td data-num="2"></td><td><pre>under low memory condition. To fix this issue <span class="token function">add</span> ‘vm.overcommit_memory <span class="token operator">=</span> <span class="token number">1</span>’ to <span class="token operator">></span> <span class="token operator">></span> <span class="token operator">></span> /etc/sysctl.conf and <span class="token keyword">then</span> <span class="token function">reboot</span> or run the <span class="token builtin class-name">command</span> ‘sysctl <span class="token assign-left variable">vm.overcommit_memory</span><span class="token operator">=</span><span class="token number">1</span>’ <span class="token operator">></span> <span class="token keyword">for</span> this to take effect.</pre></td></tr></table></figure><p>需要进行内存设置（服务器配置太拉的要？）<br><code>echo 1 &gt; /proc/sys/vm/overcommit_memory</code> 即可</p><div class="note info no-icon"><ul><li>0， 表示内核将检查是否有足够的可用内存供应用进程使用；如果有足够的可用内存，内存申请允许；否则，内存申请失败，并把错误返回给应用进程</li><li>1，表示内核允许分配所有的物理内存，而不管当前的内存状态如何</li><li>2， 表示内核允许分配超过所有物理内存和交换空间总和的内存</li></ul></div><h2 id="java中使用"><a class="anchor" href="#java中使用">#</a> Java 中使用</h2><ul><li>Redis 的 Java 客户端有很多，官方推荐的有三种<ul><li><code>Jedis</code></li><li><code>Lettuce</code></li><li><code>Redisson</code></li></ul></li><li>Spring 对 Redis 客户端进行了整合，提供了 SpringDataRedis，在 Spring Boot 项目中还提供了对应的 Starter，即 <code>spring-boot-starter-data-redis</code></li></ul><h3 id="jedis"><a class="anchor" href="#jedis">#</a> Jedis</h3><ul><li>使用 Jedis 的步骤<ol><li>获取连接</li><li>执行操作</li><li>关闭连接</li></ol></li><li>在此之前我们需要导入一下 Jedis 的 maven 坐标</li></ul><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  </pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  </pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  </pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>2.8.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>  </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><ul><li>编写测试类</li></ul><figure class="highlight java"><figcaption data-lang="java"><span>title:RedisTestApplicationTests</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@SpringBootTest</span>  </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">RedisTestApplicationTests</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="3"></td><td><pre>  </pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token annotation punctuation">@Test</span>  </pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token comment">//1. 获取连接  </span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token class-name">Jedis</span> jedis <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Jedis</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span> <span class="token number">6379</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token comment">//2. 执行具体操作  </span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token comment">//key、value set 到 redis 中</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        jedis<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Hades"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>		<span class="token comment">//hashset: 对于某些不定项操作可以利用哈希扩展</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        jedis<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">"stu"</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Jerry"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="14"></td><td><pre>        jedis<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">"stu"</span><span class="token punctuation">,</span> <span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token string">"18"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="15"></td><td><pre>        jedis<span class="token punctuation">.</span><span class="token function">hset</span><span class="token punctuation">(</span><span class="token string">"stu"</span><span class="token punctuation">,</span> <span class="token string">"num"</span><span class="token punctuation">,</span> <span class="token string">"4204000400"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="16"></td><td><pre>  </pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">hgetAll</span><span class="token punctuation">(</span><span class="token string">"stu"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> keySet <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token operator">:</span> keySet<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token class-name">String</span> value <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>key <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token punctuation">&#125;</span>  </pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token class-name">String</span> name <span class="token operator">=</span> jedis<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="25"></td><td><pre>        <span class="token comment">//3. 关闭连接  </span></pre></td></tr><tr><td data-num="26"></td><td><pre>        jedis<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token punctuation">&#125;</span>  </pre></td></tr><tr><td data-num="28"></td><td><pre>  </pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>另外两个类似，导入坐标，获取链接，使用各自的接口函数</p><h3 id="spring-data-redis"><a class="anchor" href="#spring-data-redis">#</a> Spring Data Redis</h3><ul><li>SpringBoot 项目中，可以使用 SpringDataRedis 来简化 Redis（常用）</li><li>Spring Data Redis 中提供了一个高度封装的类：RedisTemplate，针对 jedis 客户端中大量 api 进行了归类封装，将同一类型操作封装为 operation 接口，具体分类如下：<ul><li>ValueOperations：简单 K-V 操作</li><li>SetOperations：set 类型数据操作</li><li>ZSetOperations：zset 类型数据操作</li><li>HashOperations：针对 map 类型的数据操作</li><li>ListOperations：针对 list 类型的数据操作</li></ul></li></ul><blockquote><ol><li>使用 SpringDataRedis，我们首先需要导入它的 maven 坐标</li></ol></blockquote><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">&lt;!--Spring Boot-redis 的依赖包 --></span>  </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  </pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  </pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><blockquote><ol start="2"><li>重新设置一下序列化器，防止出现乱码，在 config 包下创建 <code>RedisConfig</code> 配置类</li></ol></blockquote><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Configuration</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token keyword">extends</span> <span class="token class-name">CachingConfigurerSupport</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token annotation punctuation">@Bean</span>  </pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> connectionFactory<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="5"></td><td><pre>  </pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> redisTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="7"></td><td><pre>  </pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token comment">// 默认的 Key 序列化器为：JdkSerializationRedisSerializer  </span></pre></td></tr><tr><td data-num="9"></td><td><pre>        redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="10"></td><td><pre>        redisTemplate<span class="token punctuation">.</span><span class="token function">setHashKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="11"></td><td><pre>  </pre></td></tr><tr><td data-num="12"></td><td><pre>        redisTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="13"></td><td><pre>  </pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span>  </pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span>```</pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token operator">></span><span class="token number">3.</span> 配置一下连接redis的相关配置</pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>```yml</pre></td></tr><tr><td data-num="21"></td><td><pre>spring<span class="token operator">:</span>  </pre></td></tr><tr><td data-num="22"></td><td><pre>  redis<span class="token operator">:</span>  </pre></td></tr><tr><td data-num="23"></td><td><pre>    host<span class="token operator">:</span> localhost  </pre></td></tr><tr><td data-num="24"></td><td><pre>    port<span class="token operator">:</span> <span class="token number">6379</span>  </pre></td></tr><tr><td data-num="25"></td><td><pre>    #password<span class="token operator">:</span> root  </pre></td></tr><tr><td data-num="26"></td><td><pre>    database<span class="token operator">:</span> <span class="token number">0</span> #操作的是<span class="token number">0</span>号数据库  </pre></td></tr><tr><td data-num="27"></td><td><pre>    jedis<span class="token operator">:</span>  </pre></td></tr><tr><td data-num="28"></td><td><pre>      #<span class="token class-name">Redis</span>连接池配置  </pre></td></tr><tr><td data-num="29"></td><td><pre>      pool<span class="token operator">:</span>  </pre></td></tr><tr><td data-num="30"></td><td><pre>        max<span class="token operator">-</span>active<span class="token operator">:</span> <span class="token number">8</span> #最大连接数  </pre></td></tr><tr><td data-num="31"></td><td><pre>        max<span class="token operator">-</span>wait<span class="token operator">:</span> <span class="token number">1</span>ms #连接池最大阻塞等待时间  </pre></td></tr><tr><td data-num="32"></td><td><pre>        max<span class="token operator">-</span>idle<span class="token operator">:</span> <span class="token number">4</span> #连接池中的最大空闲连接  </pre></td></tr><tr><td data-num="33"></td><td><pre>        min<span class="token operator">-</span>idle<span class="token operator">:</span> <span class="token number">0</span> #连接池中的最小空闲连接</pre></td></tr></table></figure><blockquote><ol start="4"><li>使用</li></ol></blockquote><ul><li><code>String</code> 类型数据操作</li></ul><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span>  </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">stringTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">// 获取对象  </span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">ValueOperations</span> valueOperations <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">// 设置 name 为 Hades  </span></pre></td></tr><tr><td data-num="6"></td><td><pre>    valueOperations<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"Hades"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> valueOperations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">// 设置 age 为 9527，有效时间 10 秒  </span></pre></td></tr><tr><td data-num="10"></td><td><pre>    valueOperations<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token string">"9527"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token class-name">String</span> age <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> valueOperations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment">// 如果不存在，则设置 name 为 Kyle  </span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token class-name">Boolean</span> aBoolean <span class="token operator">=</span> valueOperations<span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Kyle"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>aBoolean<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span>```</pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>输出结果如下，由于name已经存在，故<span class="token class-name">Kyle</span>设置失败，最后返回<span class="token boolean">false</span>，<span class="token number">10</span>秒过后，我们再去redis中get name，则输出`nil`，表示不存在</pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token operator">-</span> `<span class="token class-name">Hash</span>`类型数据操作</pre></td></tr><tr><td data-num="21"></td><td><pre>```java</pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token annotation punctuation">@Test</span>  </pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">void</span> <span class="token function">hashTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token class-name">HashOperations</span> hashOperations <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="25"></td><td><pre>    hashOperations<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"4204000400"</span><span class="token punctuation">,</span> <span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"Hades"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="26"></td><td><pre>    hashOperations<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"4204000400"</span><span class="token punctuation">,</span> <span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token string">"18"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="27"></td><td><pre>    hashOperations<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"4204000400"</span><span class="token punctuation">,</span> <span class="token string">"hobby"</span><span class="token punctuation">,</span> <span class="token string">"Apex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token comment">// 获取 map 集合  </span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">></span></span> map <span class="token operator">=</span> hashOperations<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span><span class="token string">"4204000400"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> keySet <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">keySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> hashKey <span class="token operator">:</span> keySet<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>hashKey <span class="token operator">+</span> <span class="token string">":"</span> <span class="token operator">+</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>hashKey<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token punctuation">&#125;</span>  </pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"$$$$$$$$$$$$$$$"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token comment">// 只获取 keys  </span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> keys <span class="token operator">=</span> hashOperations<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token string">"4204000400"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token operator">:</span> keys<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="38"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token punctuation">&#125;</span>  </pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"$$$$$$$$$$$$$$$"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token comment">// 只获取 values  </span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> values <span class="token operator">=</span> hashOperations<span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token string">"4204000400"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> value <span class="token operator">:</span> values<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="44"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="45"></td><td><pre>    <span class="token punctuation">&#125;</span>  </pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>输出结果如下</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>name:Hades  </pre></td></tr><tr><td data-num="2"></td><td><pre>age:18  </pre></td></tr><tr><td data-num="3"></td><td><pre>hobby:Apex  </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span>$  </pre></td></tr><tr><td data-num="5"></td><td><pre>name  </pre></td></tr><tr><td data-num="6"></td><td><pre>age  </pre></td></tr><tr><td data-num="7"></td><td><pre>hobby  </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span>$  </pre></td></tr><tr><td data-num="9"></td><td><pre>Hades  </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">18</span>  </pre></td></tr><tr><td data-num="11"></td><td><pre>Apex</pre></td></tr></table></figure><ul><li><code>List</code> 类型数据操作</li></ul><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span>  </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">listTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">ListOperations</span> listOperations <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// 存数据  </span></pre></td></tr><tr><td data-num="5"></td><td><pre>    listOperations<span class="token punctuation">.</span><span class="token function">leftPush</span><span class="token punctuation">(</span><span class="token string">"testData"</span><span class="token punctuation">,</span> <span class="token string">"A"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="6"></td><td><pre>    listOperations<span class="token punctuation">.</span><span class="token function">leftPushAll</span><span class="token punctuation">(</span><span class="token string">"testData"</span><span class="token punctuation">,</span> <span class="token string">"B"</span><span class="token punctuation">,</span> <span class="token string">"C"</span><span class="token punctuation">,</span> <span class="token string">"D"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> testDatas <span class="token operator">=</span> listOperations<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span><span class="token string">"testData"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 遍历  </span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> tableData <span class="token operator">:</span> testDatas<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>tableData <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span>  </pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment">// 获取当前 list 长度，用于遍历  </span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token class-name">Long</span> size <span class="token operator">=</span> listOperations<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token string">"testData"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">int</span> value <span class="token operator">=</span> size<span class="token punctuation">.</span><span class="token function">intValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token comment">// 遍历输出并删除  </span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> value<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>listOperations<span class="token punctuation">.</span><span class="token function">leftPop</span><span class="token punctuation">(</span><span class="token string">"testData"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">&#125;</span>  </pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token comment">// 最后输出一下当前 list 长度  </span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>listOperations<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token string">"testData"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>输出结果如下</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>D C B A  </pre></td></tr><tr><td data-num="2"></td><td><pre>D C B A  </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">0</span></pre></td></tr></table></figure><ul><li><code>Set</code> 类型数据操作</li></ul><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span>  </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">setTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token class-name">SetOperations</span> setOperations <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// 存数据，这里存了两个 a  </span></pre></td></tr><tr><td data-num="5"></td><td><pre>    setOperations<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"tmp"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token string">"d"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="6"></td><td><pre>    遍历输出  </pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> tmpData <span class="token operator">=</span> setOperations<span class="token punctuation">.</span><span class="token function">members</span><span class="token punctuation">(</span><span class="token string">"tmp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> value <span class="token operator">:</span> tmpData<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>value <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span>  </pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"$$$$$$$$$$$$$$$$$$$"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token comment">// 删除 bc  </span></pre></td></tr><tr><td data-num="14"></td><td><pre>    setOperations<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"tmp"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token comment">// 再次遍历输出  </span></pre></td></tr><tr><td data-num="16"></td><td><pre>    tmpData <span class="token operator">=</span> setOperations<span class="token punctuation">.</span><span class="token function">members</span><span class="token punctuation">(</span><span class="token string">"tmp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> value <span class="token operator">:</span> tmpData<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>value <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token punctuation">&#125;</span>  </pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>输出结果如下，符合预期</p><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>d b c a  </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span>$  </pre></td></tr><tr><td data-num="3"></td><td><pre>d a</pre></td></tr></table></figure><ul><li>通用的数据类型操作</li></ul><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Test</span>  </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">void</span> <span class="token function">commonTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token comment">// 查看所有 key  </span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> keys <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token operator">:</span> keys<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span>  </pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token comment">// 查看是否存在指定 key  </span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"$$$$$$$$$$$$$$$$$$$$$$$$$"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">hasKey</span><span class="token punctuation">(</span><span class="token string">"Random"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"$$$$$$$$$$$$$$$$$$$$$$$$$"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token comment">// 删除指定 key，并再次查看  </span></pre></td></tr><tr><td data-num="13"></td><td><pre>    redisTemplate<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">"myZset"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="14"></td><td><pre>    keys <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> key <span class="token operator">:</span> keys<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span>  </pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"$$$$$$$$$$$$$$$$$$$$$$$$$"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment">// 输出指定 key 的类型  </span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>redisTemplate<span class="token punctuation">.</span><span class="token function">type</span><span class="token punctuation">(</span><span class="token string">"tmp"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>tmp  </pre></td></tr><tr><td data-num="2"></td><td><pre>name  </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">4204000400</span>  </pre></td></tr><tr><td data-num="4"></td><td><pre>stu  </pre></td></tr><tr><td data-num="5"></td><td><pre>myData  </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span>$  </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token boolean">false</span>  </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span>$  </pre></td></tr><tr><td data-num="9"></td><td><pre>tmp  </pre></td></tr><tr><td data-num="10"></td><td><pre>name  </pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">4204000400</span>  </pre></td></tr><tr><td data-num="12"></td><td><pre>stu  </pre></td></tr><tr><td data-num="13"></td><td><pre>myData  </pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span><span class="token variable">$$</span>$  </pre></td></tr><tr><td data-num="15"></td><td><pre>SET</pre></td></tr></table></figure><h2 id="简单案例"><a class="anchor" href="#简单案例">#</a> 简单案例</h2><blockquote><p>导入 SpringDataRedis 的 maven 坐标</p></blockquote><p>使用 SpringDataRedis</p><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  </pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  </pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><blockquote><p>配置文件</p></blockquote><ul><li>配置连接 redis 的数据，我这里配置的是我的云服务器上装的 Redis</li></ul><figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span>  </pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">redis</span><span class="token punctuation">:</span>  </pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost  <span class="token comment"># 或者服务器上的</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>  </pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token comment">#password: root  </span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token comment">#操作的是 0 号数据库  </span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token key atrule">jedis</span><span class="token punctuation">:</span>  </pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token comment">#Redis 连接池配置  </span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token key atrule">pool</span><span class="token punctuation">:</span>  </pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">8</span> <span class="token comment">#最大连接数  </span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> 1ms <span class="token comment">#连接池最大阻塞等待时间  </span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">4</span> <span class="token comment">#连接池中的最大空闲连接  </span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0</span> <span class="token comment">#连接池中的最小空闲连接</span></pre></td></tr></table></figure><blockquote><p>配置类</p></blockquote><ul><li>配置一下序列化器，方便我们在图形化界面中查看我们存入的数据，在 config 包下新建 RedisConfig 类</li><li>但是也可以不配置 RedisConfig，而是直接用 <code>SpringRedisConfig</code> ，它的默认序列化器就是 <code>StringRedisSerializer</code></li></ul><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Configuration</span>  </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedisConfig</span> <span class="token keyword">extends</span> <span class="token class-name">CachingConfigurerSupport</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token annotation punctuation">@Bean</span>  </pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> <span class="token function">redisTemplate</span><span class="token punctuation">(</span><span class="token class-name">RedisConnectionFactory</span> connectionFactory<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">></span></span> redisTemplate <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedisTemplate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token comment">// 默认 key 序列化器为：JdkSerializationRedisSerializer  </span></pre></td></tr><tr><td data-num="7"></td><td><pre>        redisTemplate<span class="token punctuation">.</span><span class="token function">setKeySerializer</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">StringRedisSerializer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="8"></td><td><pre>        redisTemplate<span class="token punctuation">.</span><span class="token function">setConnectionFactory</span><span class="token punctuation">(</span>connectionFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">return</span> redisTemplate<span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span>  </pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>测试</p></blockquote><p>在测试类中测试，再次读取时有持久化的对象。但用 redis desktop 修改的数据无法反序列化回来，爷晕晕</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>zy</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="2"></td><td><pre>  </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>jupiter<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">Test</span></span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">Autowired</span></span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span></span><span class="token class-name">SpringBootTest</span></span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">RedisTemplate</span></span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">ValueOperations</span></span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">GenericJackson2JsonRedisSerializer</span></span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">RedisSerializer</span></span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>redis<span class="token punctuation">.</span>serializer<span class="token punctuation">.</span></span><span class="token class-name">StringRedisSerializer</span></span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="11"></td><td><pre>  </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="13"></td><td><pre>  </pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token annotation punctuation">@SpringBootTest</span>  </pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">class</span> <span class="token class-name">TestApplicationTests</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token annotation punctuation">@Autowired</span>  </pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token annotation punctuation">@Test</span>  </pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token keyword">void</span> <span class="token function">stringTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token comment">// 获取对象  </span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token class-name">ValueOperations</span> valueOperations <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token comment">// 设置 name 为 Hades  </span></pre></td></tr><tr><td data-num="25"></td><td><pre>        valueOperations<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span><span class="token string">"ZYK"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token class-name">String</span> name <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> valueOperations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="27"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token comment">// 设置 age 为 9527，有效时间 10 秒  </span></pre></td></tr><tr><td data-num="29"></td><td><pre>        valueOperations<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span> <span class="token string">"9527"</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token class-name">String</span> age <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> valueOperations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token comment">// 如果不存在，则设置 name 为 Kyle  </span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token class-name">Boolean</span> aBoolean <span class="token operator">=</span> valueOperations<span class="token punctuation">.</span><span class="token function">setIfAbsent</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">,</span> <span class="token string">"111"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>aBoolean<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre>		<span class="token comment">// 注释掉上面除 valueOperations，再次测试读取数据</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span>valueOperations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token punctuation">&#125;</span>  </pre></td></tr><tr><td data-num="39"></td><td><pre>  </pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>开发中能做什么呢？</p><ul><li>缓存短信<ul><li>替换掉 session，避免服务器的开销，因为还要存用户 id 之类的</li></ul></li><li>缓存商品信息<ul><li>比如用户的购物车里的，或者历史订单，这种显示固定内容的，避免反复查询</li><li>但要注意在其他 update、save、delete 等业务逻辑时要删除对应的 redis 数据，让其在执行查询业务的时候重新加载</li></ul></li><li>能放图片吗？<ul><li>能，基于 base64 编解码</li><li>&quot;字符串类型是 Redis 中最基本的数据类型，它能存储任何形式的字符串，包括二进制数据。你可以用其存储用户的邮箱、JSON 化的对象甚至是一张图片&quot;</li></ul></li></ul><h2 id="结合spring-cache"><a class="anchor" href="#结合spring-cache">#</a> 结合 spring cache</h2><ul><li>SpringCache 是一个框架，实现了基本注解的缓存功能，只需要简单的添加一个注解，就能实现缓存功能</li><li>SpringCache 提供了一层抽象，底层可以切换不同的 cache 实现，具体就是通过 CacheManager 接口来统一不同的缓存技术</li><li>针对不同的缓存技术，需要实现不同的 CacheManager</li></ul><table><thead><tr><th>CacheManger</th><th>描述</th></tr></thead><tbody><tr><td>EhCacheCacheManager</td><td>使用 EhCache 作为缓存技术</td></tr><tr><td>GuavaCacheManager</td><td>使用 Googke 的 GuavaCache 作为缓存技术</td></tr><tr><td>RedisCacheManager</td><td>使用 Redis 作为缓存技术</td></tr></tbody></table><h3 id="常用注解"><a class="anchor" href="#常用注解">#</a> 常用注解</h3><table><thead><tr><th>注解</th><th>说明</th></tr></thead><tbody><tr><td>@EnableCaching</td><td>开启缓存注解功能</td></tr><tr><td>@Cacheable</td><td>在方法执行前 spring 先查看缓存中是否有数据。如果有数据，则直接返回缓存数据；若没有数据，调用方法并将方法返回值放到缓存中</td></tr><tr><td>@CachePut</td><td>将方法的返回值放到缓存中</td></tr><tr><td>@CacheEvict</td><td>将一条或者多条数据从缓存中删除</td></tr></tbody></table><p><code>@Cacheable</code> 的作用主要针对方法配置，能够根据方法的请求参数对其结果进行缓存，其主要参数说明如下</p><table><thead><tr><th>注解</th><th>说明 &lt;img width=300/&gt;</th><th>举例</th></tr></thead><tbody><tr><td>value</td><td>缓存的名称，在 spring 配置文件中定义，必须指定至少一个</td><td>例如:@Cacheable (value=“mycache”) 或者 @Cacheable (value=(“cache7”, “cache2”]</td></tr><tr><td>key</td><td>缓存的 key，可以为空，如果指定要按照 SpEL 表达式编写，如果不指定，则缺省按照方法的所有参数进行组合</td><td>例如:@Cacheable (value=“testcache”,key=“#userName”)</td></tr><tr><td>condition</td><td>缓存的条件，可以为空，使用 SpEL 编写，返回 true 或者 false，只有为 true 才进行缓存</td><td>例如:@Cacheable (value=“testcache”,condition=“#userName.length ()&gt;2”)</td></tr></tbody></table><p><code>@CachEvict</code> 的作用主要针对方法配置，能够根据一定的条件对缓存进行清空</p><table><thead><tr><th>注解</th><th>说明 &lt;img width=300/&gt;</th><th>举例</th></tr></thead><tbody><tr><td>value</td><td>缓存的名称，在 spring 配置文件中定义，必须指定至少一个</td><td>例如:@Cacheable (value=“mycache”) 或者 @Cacheable (value={“cache1”, “cache2”]</td></tr><tr><td>key</td><td>缓存的 key，可以为空，如果指定要按照 SpEL 表达式编写，如果不指定，则缺省按照方法的所有参数进行组合</td><td>例如:@Cacheable (value=“testcache”,key=“#userName”)</td></tr><tr><td>condition</td><td>缓存的条件，可以为空，使用 SpEL 编写，返回 true 或者 false，只有为 true 才进行缓存</td><td>例如:@Cacheable (value=“testcache”,condition=“#userName.length ()&gt;2”)</td></tr><tr><td>allEntries</td><td>是否清空所有缓存内容，缺省为 false，如果指定为 true，则方法调用后将立即清空所有缓存</td><td>例如:@CachEvict (value=“testcache”,allEntries=true)</td></tr><tr><td>beforelnvocation</td><td>是否在方法执行前就清空，缺省为 false，如果指定为 true，则在方法还没有执行的时候就清空缓存，缺省情况下，如果方法执行抛出异常，则不会清空缓存</td><td>例如:@CachEvict (value=“testcache”, beforelnvocation=true)</td></tr></tbody></table><h3 id="使用"><a class="anchor" href="#使用">#</a> 使用</h3><blockquote><p>导入坐标</p></blockquote><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  </pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  </pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span>  </pre></td></tr><tr><td data-num="5"></td><td><pre>  </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  </pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  </pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>spring-boot-starter-cache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><blockquote><p>配置 application.yml</p></blockquote><figure class="highlight yml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span>  </pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">redis</span><span class="token punctuation">:</span>  </pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token key atrule">host</span><span class="token punctuation">:</span> 101.XXX.XXX.160 <span class="token comment"># 本地 localhost 或者 开启了 redis 的服务器的 ip  </span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token comment"># redis 服务设置的密码，不是服务器密码噢 </span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>  </pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">database</span><span class="token punctuation">:</span> <span class="token number">0</span>  </pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token key atrule">cache</span><span class="token punctuation">:</span>  </pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token key atrule">redis</span><span class="token punctuation">:</span>  </pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token key atrule">time-to-live</span><span class="token punctuation">:</span> <span class="token number">3600000</span> <span class="token comment">#设置存活时间为一小时，如果不设置，则一直存活</span></pre></td></tr></table></figure><blockquote><p>application 添加 <code>@EnableCaching</code> 注解</p></blockquote><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Slf4j</span>  </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token annotation punctuation">@SpringBootApplication</span>  </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token annotation punctuation">@ServletComponentScan</span>  </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token annotation punctuation">@EnableTransactionManagement</span>  </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token annotation punctuation">@EnableCaching</span>  <span class="token comment">// 开启缓存注解功能  </span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ReggieApplication</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ReggieApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="9"></td><td><pre>        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"项目 启动!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token punctuation">&#125;</span>  </pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><blockquote><p>方法处（多为处理查询请求）添加相应的注解</p></blockquote><p><code>@Cacheale</code> ，功能是：</p><ul><li>在方法执行前，Spring 先查看缓存中是否有数据；如果有数据，则直接返回缓存数据；若没有数据，调用方法并将方法返回值放到缓存中</li></ul><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/list"</span><span class="token punctuation">)</span>  </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token annotation punctuation">@Cacheable</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"setmealCache"</span><span class="token punctuation">,</span> key <span class="token operator">=</span> <span class="token string">"#setmeal.categoryId + '_' + #setmeal.status"</span><span class="token punctuation">)</span>  </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Setmeal</span><span class="token punctuation">></span><span class="token punctuation">></span></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token class-name">Setmeal</span> setmeal<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token comment">// 条件构造器  </span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Setmeal</span><span class="token punctuation">></span></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LambdaQueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token comment">// 添加条件  </span></pre></td></tr><tr><td data-num="7"></td><td><pre>    queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>setmeal<span class="token punctuation">.</span><span class="token function">getCategoryId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">Setmeal</span><span class="token operator">::</span><span class="token function">getCategoryId</span><span class="token punctuation">,</span> setmeal<span class="token punctuation">.</span><span class="token function">getCategoryId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="8"></td><td><pre>    queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span>setmeal<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token class-name">Setmeal</span><span class="token operator">::</span><span class="token function">getStatus</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token comment">// 排序  </span></pre></td></tr><tr><td data-num="10"></td><td><pre>    queryWrapper<span class="token punctuation">.</span><span class="token function">orderByDesc</span><span class="token punctuation">(</span><span class="token class-name">Setmeal</span><span class="token operator">::</span><span class="token function">getUpdateTime</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Setmeal</span><span class="token punctuation">></span></span> setmealList <span class="token operator">=</span> setmealService<span class="token punctuation">.</span><span class="token function">list</span><span class="token punctuation">(</span>queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span>setmealList<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>@CacheEvict</code> 该注解的功能是：</p><ul><li>将一条或者多条数据从缓存中删除</li></ul><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@PostMapping</span>  </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment">// 设置 allEntries 为 true，清空缓存名称为 setmealCache 的所有缓存  </span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token annotation punctuation">@CacheEvict</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"setmealCache"</span><span class="token punctuation">,</span> allEntries <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>  </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">public</span> <span class="token class-name">Result</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">></span></span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">SetmealDto</span> setmealDto<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>  </pre></td></tr><tr><td data-num="5"></td><td><pre>    log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"套餐信息：&#123;&#125;"</span><span class="token punctuation">,</span> setmealDto<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="6"></td><td><pre>    setmealService<span class="token punctuation">.</span><span class="token function">saveWithDish</span><span class="token punctuation">(</span>setmealDto<span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">"套餐添加成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><div class="note warning no-icon"><ul><li>要缓存的 JAVA 对象必须实现 <code>Serializable</code> 接口，因为 Spring 会先将对象序列化再存入 Redis，将缓存实体类继承 <code>Serializable</code></li><li>所以对于请求方法中返回的数据其封装类要添加 <code>implements Serializable</code></li><li>一般数据类都要这么写：</li></ul><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token annotation punctuation">@Data</span>  </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">&#123;</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></div><h1 id="mysql主从复制"><a class="anchor" href="#mysql主从复制">#</a> MySQL 主从复制</h1><ul><li><p>MySQL 主从复制是一个异步的复制过程，底层是基于 Mysql 数据库自带的二进制日志功能。就是一台或多台 NysQL 数据库（slave，即从库）从另一台 MySQL 数据库 (master，即主库）进行日志的复制然后再解析日志并应用到自身，最终实现从库的数据和主库的数据保持一致。MySQL 主从复制是 MySQL 数据库自带功能，无需借助第三方工具。</p></li><li><p>MySQL 复制过程分成三步:</p><ol><li><code>maste</code> r 将改变记录到二进制日志 ( <code>binary log</code> )</li><li><code>slave</code> 将 <code>master</code> 的 <code>binary log</code> 拷贝到它的中继日志 ( <code>relay log</code> )</li><li><code>slave</code> 重做中继日志中的事件，将改变应用到自己的数据库中</li></ol></li></ul><p><img data-src="image-20240326180113088.png" alt=""><br>更细的说应该是三个线程： <code>master（binlog dump thread）、slave（I/O thread 、SQL thread）</code> ，Master 一条线程和 Slave 中的两条线程。</p><ol><li><code>master（binlog dump thread）</code> 主要负责 Master 库中有数据更新的时候，会按照 <code>binlog</code> 格式，将更新的事件类型写入到主库的 <code>binlog</code> 文件中。</li><li>并且，Master 会创建 <code>log dump</code> 线程通知 Slave 主库中存在数据更新，这就是为什么主库的 binlog 日志一定要开启的原因。</li><li><code>I/O thread</code> 线程在 Slave 中创建，该线程用于请求 Master，Master 会返回 binlog 的名称以及当前数据更新的位置、binlog 文件位置的副本。</li><li>然后，将 <code>binlog</code> 保存在 <strong>「relay log（中继日志）」</strong> 中，中继日志也是记录数据更新的信息。</li><li>SQL 线程也是在 Slave 中创建的，当 Slave 检测到中继日志有更新，就会将更新的内容同步到 Slave 数据库中，这样就保证了主从的数据的同步。</li></ol><h2 id="配置"><a class="anchor" href="#配置">#</a> 配置</h2><h3 id="主库"><a class="anchor" href="#主库">#</a> 主库</h3><p>在配置文件 <code>/etc/my.cnf</code> 中</p><ul><li>找到 <code>[mysqld]</code> ，在下面插入两行</li></ul><blockquote><p>log_bin=mysql-bin #[必须] 启用二进制日志<br>server-id=1 #[必须] 服务器唯一 ID, 只需要确保其 id 是唯一的就好<br>binlog-do-db=sjk1_sjk2_sjk3 # 设置要复制的库，多个库用_连接</p></blockquote><ul><li>重启服务 <code>systemctl restart mysqld</code></li><li>连接数据库，执行 <code>grant replication slave on *.* to 'zy'@'%' identified by '123456';</code><ul><li>上面的 SQL 的作用是创建一个用户 <code>zy</code> , 密码为 <code>123456</code> ，并且给 <code>zy</code> 用户授予 <code>replication slave</code> 权限，用于建立复制时所需要用到的用户权限，也就是 <code>slave</code> 必须被 <code>master</code> 授权具有该权限的用户，才能通过该用户复制，这是因为主库和从库之间需要互相通信，处于安全考虑，只有通过验证的从库才能从主库中读取二进制数据</li></ul></li><li><code>show master status;</code> 打印状态，主要是 File 和 Position 的值</li></ul><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>+------------------+----------+--------------+------------------+-------------------+  </pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">|</span> File             <span class="token operator">|</span> Position <span class="token operator">|</span> Binlog_Do_DB <span class="token operator">|</span> Binlog_Ignore_DB <span class="token operator">|</span> Executed_Gtid_Set <span class="token operator">|</span>  </pre></td></tr><tr><td data-num="3"></td><td><pre>+------------------+----------+--------------+------------------+-------------------+  </pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">|</span> mysql-bin.000005 <span class="token operator">|</span>      <span class="token number">154</span> <span class="token operator">|</span>              <span class="token operator">|</span>                  <span class="token operator">|</span>                   <span class="token operator">|</span>  </pre></td></tr><tr><td data-num="5"></td><td><pre>+------------------+----------+--------------+------------------+-------------------+</pre></td></tr></table></figure><h3 id="从库"><a class="anchor" href="#从库">#</a> 从库</h3><ul><li>同样的在配置文件插入 id， <code>server-id=2</code> ，与主库不同</li><li>重启后连接 MySQL 控制台<pre><code class="language-SQL">change master to master_host='ip',master_user='zy',master_password='123456',master_log_file='mysql-bin.000005',master_log_pos=154;  # 配置
</code></pre></li></ul><p>sstart slave; # 开启<br>```</p><ul><li>查询从库状态 <code>show slave status;</code> ，这 2 个选项对应则成功</li></ul><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>Slave_IO_Running: Yes  </pre></td></tr><tr><td data-num="2"></td><td><pre>Slave_SQL_Running: Yes</pre></td></tr></table></figure><h2 id="结合sharding-jdbc"><a class="anchor" href="#结合sharding-jdbc">#</a> 结合 Sharding-JDBC</h2><ul><li>Sharding-JDBC 定位为轻量级的 JAVA 框架，在 JAVA 的 JDBC 层提供额外的服务，它使得客户端直连数据库，以 jar 包形式提供服务，无需额外部署和依赖，可理解为增强版的 JDBC 驱动，完全兼容 JDBC 和各种 ORM 框架</li><li>使用 Sharding-JDBC 可以在程序中轻松的实现数据库读写分离<ul><li>适用于任何基于 JDBC 的 ORM 框架</li><li>支持任何第三方的数据库连接池</li><li>支持任意实现 JDBC 规范的数据库</li></ul></li><li>使用 Sharding-JDBC 框架的步骤<ol><li>导入对应的 maven 坐标</li><li>在配置文件中配置读写分离规则</li><li>在配置文件中配置允许 bean 定义覆盖配置项</li></ol></li></ul><figure class="highlight xml"><figcaption data-lang="XML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">></span></span>  </pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">></span></span>org.apache.shardingsphere<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">></span></span>  </pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">></span></span>sharding-jdbc-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">></span></span>  </pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">></span></span>4.0.0-RC1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">></span></span>  </pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">></span></span></pre></td></tr></table></figure><figure class="highlight yml"><figcaption data-lang="YAML"><span>title:application.yml</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">spring</span><span class="token punctuation">:</span>  </pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token key atrule">shardingsphere</span><span class="token punctuation">:</span>  </pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token key atrule">datasource</span><span class="token punctuation">:</span>  </pre></td></tr><tr><td data-num="4"></td><td><pre>      <span class="token key atrule">names</span><span class="token punctuation">:</span>  </pre></td></tr><tr><td data-num="5"></td><td><pre>        master<span class="token punctuation">,</span>slave  </pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token key atrule">master</span><span class="token punctuation">:</span>  </pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource  </pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver  </pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/springboot_work</pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token key atrule">username</span><span class="token punctuation">:</span> root  </pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>  </pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token key atrule">slave</span><span class="token punctuation">:</span>  </pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource  </pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver  </pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//47.115.211.251<span class="token punctuation">:</span>3306/test</pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token key atrule">username</span><span class="token punctuation">:</span> root  </pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>  </pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token key atrule">masterslave</span><span class="token punctuation">:</span>  </pre></td></tr><tr><td data-num="19"></td><td><pre>      <span class="token comment">## 读写分离配置 </span></pre></td></tr><tr><td data-num="20"></td><td><pre>      <span class="token key atrule">load-balance-algorithm-type</span><span class="token punctuation">:</span> round_robin  </pre></td></tr><tr><td data-num="21"></td><td><pre>      <span class="token comment">## 最终的数据源名称  </span></pre></td></tr><tr><td data-num="22"></td><td><pre>      <span class="token key atrule">name</span><span class="token punctuation">:</span> dataSource  </pre></td></tr><tr><td data-num="23"></td><td><pre>      <span class="token comment">## 主库数据源名称  </span></pre></td></tr><tr><td data-num="24"></td><td><pre>      <span class="token key atrule">master-data-source-name</span><span class="token punctuation">:</span> master  </pre></td></tr><tr><td data-num="25"></td><td><pre>      <span class="token comment">## 从库数据源名称列表，多个逗号分隔  </span></pre></td></tr><tr><td data-num="26"></td><td><pre>      <span class="token key atrule">slave-data-source-names</span><span class="token punctuation">:</span> slave  </pre></td></tr><tr><td data-num="27"></td><td><pre>    <span class="token key atrule">props</span><span class="token punctuation">:</span>  </pre></td></tr><tr><td data-num="28"></td><td><pre>      <span class="token key atrule">sql</span><span class="token punctuation">:</span>  </pre></td></tr><tr><td data-num="29"></td><td><pre>        <span class="token key atrule">show</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#开启 SQL 显示，默认 false  </span></pre></td></tr><tr><td data-num="30"></td><td><pre>  <span class="token key atrule">main</span><span class="token punctuation">:</span>  </pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token key atrule">allow-bean-definition-overriding</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr></table></figure><h1 id="njinx"><a class="anchor" href="#njinx">#</a> Njinx</h1><p>Nginx 是一款轻量级的<em> web 服务器 / 反向代理服务器</em>及电子邮件 (IMAP/POP3) 代理服务器。其特点是占有<strong>内存少，并发能力强</strong>，事实上 nginx 的并发能力在同类型的网页服务器中表现较好，中国大陆使用 nginx 的网站有：百度、京东、新浪、网易、腾讯、淘宝等。</p><p>下载安装类似 redis，下载、解压，然后 make</p><h2 id="目录结构"><a class="anchor" href="#目录结构">#</a> 目录结构</h2><ul><li>重点目录 / 文件:<ul><li>conf/nginx.conf<ul><li>nginx 配置文件</li></ul></li><li>html<ul><li>存放静态文件 (html、css、Js 等)</li></ul></li><li>logs<ul><li>日志目录，存放日志文件</li></ul></li><li>sbin/nginx<ul><li>二进制文件，用于启动、停止 Nginx 服务</li></ul></li></ul></li><li>文件目录树状图如下</li></ul><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">.</span>  </pre></td></tr><tr><td data-num="2"></td><td><pre>├── conf                        <span class="token operator">&lt;</span>-- Nginx配置  </pre></td></tr><tr><td data-num="3"></td><td><pre>│   ├── fastcgi.conf  </pre></td></tr><tr><td data-num="4"></td><td><pre>│   ├── fastcgi.conf.default  </pre></td></tr><tr><td data-num="5"></td><td><pre>│   ├── fastcgi_params  </pre></td></tr><tr><td data-num="6"></td><td><pre>│   ├── fastcgi_params.default  </pre></td></tr><tr><td data-num="7"></td><td><pre>│   ├── koi-utf  </pre></td></tr><tr><td data-num="8"></td><td><pre>│   ├── koi-win  </pre></td></tr><tr><td data-num="9"></td><td><pre>│   ├── mime.types  </pre></td></tr><tr><td data-num="10"></td><td><pre>│   ├── mime.types.default  </pre></td></tr><tr><td data-num="11"></td><td><pre>│   ├── nginx.conf              <span class="token operator">&lt;</span>-- 主要的配置文件 </pre></td></tr><tr><td data-num="12"></td><td><pre>│   ├── nginx.conf.default  </pre></td></tr><tr><td data-num="13"></td><td><pre>│   ├── scgi_params  </pre></td></tr><tr><td data-num="14"></td><td><pre>│   ├── scgi_params.default  </pre></td></tr><tr><td data-num="15"></td><td><pre>│   ├── uwsgi_params  </pre></td></tr><tr><td data-num="16"></td><td><pre>│   ├── uwsgi_params.default  </pre></td></tr><tr><td data-num="17"></td><td><pre>│   └── win-utf  </pre></td></tr><tr><td data-num="18"></td><td><pre>├── html                        <span class="token operator">&lt;</span>-- 存放静态文件，部署项目就要将静态文件放在这</pre></td></tr><tr><td data-num="19"></td><td><pre>│   ├── 50x.html          </pre></td></tr><tr><td data-num="20"></td><td><pre>│   └── index.html              <span class="token operator">&lt;</span>-- 提供的默认的页面  </pre></td></tr><tr><td data-num="21"></td><td><pre>├── logs                        <span class="token operator">&lt;</span>-- 日志目录，新装的Nginx，所以还没有日志文件  </pre></td></tr><tr><td data-num="22"></td><td><pre>└── sbin                          </pre></td></tr><tr><td data-num="23"></td><td><pre>└── nginx                       <span class="token operator">&lt;</span>-- 这个文件也经常操作</pre></td></tr></table></figure><h2 id="nginxconf"><a class="anchor" href="#nginxconf">#</a> nginx.conf</h2><ul><li>Nginx 配置文件 (conf/nginx.conf) 整体分为三部分<ul><li>全局块 和 Nginx 运行相关的全局配置</li><li>events 块 和网络连接相关的配置</li><li>http 块 代理、缓存、日志记录、虚拟主机配置<ul><li>http 全局块</li><li>Server 块<ul><li>Server 全局块</li><li>location 块</li></ul></li></ul></li></ul></li></ul><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 工作进程的数量</span></pre></td></tr><tr><td data-num="2"></td><td><pre>worker_processes  <span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>events <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    worker_connections  <span class="token number">1024</span><span class="token punctuation">;</span> <span class="token comment"># 每个工作进程连接数</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>http <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    include       mime.types<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    default_type  application/octet-stream<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token comment"># 日志格式</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    log_format  access  <span class="token string">'$remote_addr - $remote_user [$time_local] $host "$request" '</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                  <span class="token string">'$status $body_bytes_sent "$http_referer" '</span></pre></td></tr><tr><td data-num="14"></td><td><pre>                  <span class="token string">'"$http_user_agent" "$http_x_forwarded_for" "$clientip"'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    access_log  /srv/log/nginx/access.log  access<span class="token punctuation">;</span> <span class="token comment"># 日志输出目录</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token function">gzip</span>  on<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    sendfile  on<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token comment"># 链接超时时间，自动断开</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    keepalive_timeout  <span class="token number">60</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token comment"># 虚拟主机</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    server <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>        listen       <span class="token number">8080</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>        server_name  localhost<span class="token punctuation">;</span> <span class="token comment"># 浏览器访问域名</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>        charset utf-8<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        access_log  logs/localhost.access.log  access<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token comment"># 路由</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        location / <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>            root   www<span class="token punctuation">;</span> <span class="token comment"># 访问根目录</span></pre></td></tr><tr><td data-num="33"></td><td><pre>            index  index.html index.htm<span class="token punctuation">;</span> <span class="token comment"># 入口文件</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token comment"># 引入其他的配置文件</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    include servers/*<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>复制代码</pre></td></tr></table></figure><h2 id="nginx命令"><a class="anchor" href="#nginx命令">#</a> Nginx 命令</h2><ul><li><p>查看版本</p><ul><li>进入 sbin 目录，输入 <code>./nginx -v</code></li></ul></li><li><p>检查配置文件正确性</p><ul><li>进入 sbin 目录，输入 <code>./nginx -t</code> ，如果有错误会报错，而且也会记日志</li></ul></li></ul><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre>nginx: the configuration <span class="token function">file</span> /usr/local/nginx/conf/nginx.conf syntax is ok  <span class="token operator">&lt;</span>brnginx: configuration <span class="token function">file</span> /usr/local/nginx/conf/nginx.conf <span class="token builtin class-name">test</span> is successful</pre></td></tr></table></figure><ul><li><p>启动和停止</p><ul><li>进入 sbin 目录，输入 <code>./nginx</code> ，启动完成后查看进程</li><li>如果想停止 Nginx 服务，输入 <code>./nginx -s stop</code> ，停止服务后再次</li><li><code>ps aux | grep nginx</code> 查看进程</li></ul></li><li><p>重新加载配置文件</p><ul><li>当修改 Nginx 配置文件后，需要重新加载才能生效，可以使用下面命令重新加载配置文件： <code>./nginx -s reload</code> 。</li></ul></li><li><p>上面的所有命令，都需要我们在 sbin 目录下才能运行，比较麻烦，所以我们可以将 Nginx 的二进制文件配置到环境变量中，这样无论我们在哪个目录下，都能使用上面的命令</p><ul><li>使用 <code>vim /etc/profile</code> 命令打开配置文件，添加后保存并退出</li></ul><figure class="highlight shell"><figcaption data-lang="Bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># PATH=$JAVA_HOME/bin:$PATH  </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/local/nginx/sbin:<span class="token variable">$JAVA_HOME</span>/bin:<span class="token environment constant">$PATH</span></pre></td></tr></table></figure><ul><li>之后重新加载系统配置文件，使用 <code>source /etc/profile</code> 命令，然后我们在任意位置输入 <code>nginx</code> 即可启动服务， <code>nginx -s stop</code> 即可停止服务</li></ul></li><li><p>查看自己 IP，启动服务后，浏览器输入 ip 地址就可以访问 Nginx 的默认页面</p><ul><li><code>ip addr</code></li></ul></li></ul><h2 id="资源代理"><a class="anchor" href="#资源代理">#</a> 资源代理</h2><p>静态资源复制到 njinx/html/ 下，在 nginx.conf 的 http {...}/https 中</p><pre><code class="language-conf">server &#123;  
    listen 82;  # 监听端口
    server_name ip1;   # 服务器名称


	# 路由 
	location / &#123; 
		root www; # 访问根目录 
		index index.html index.htm; # 入口文件 
		proxy_pass http://ip2  # 要代理的
	&#125;
&#125;
</code></pre><p>也就是访问 ip1 的 82，实际访问到了 ip2<br>也可以针对不同的资源 <code>192.168.17.129:9001/edu/</code> 和 <code>192.168.17.129:9001/vod/</code> 下的资源被分别代理到了 <code>http://127.0.0.1:8080</code> 和 <code>http://127.0.0.1:8081</code></p><pre><code class="language-conf">server &#123;
	 listen       9001;
	 server_name  192.168.17.129;
	
	 location ~ /edu/ &#123;
	  proxy_pass  http://127.0.0.1:8080
	 &#125;
	
	 location ~ /vod/ &#123;
	  proxy_pass  http://127.0.0.1:8081
	 &#125;
&#125;
</code></pre><h2 id="负载均衡"><a class="anchor" href="#负载均衡">#</a> 负载均衡</h2><p>即是多个被代理的放在 <code>upstream name &#123;&#125;</code> 中。 <code>sever</code> 的 <code>proxy_pass</code> 是前面的 name</p><pre><code class="language-conf">upstream targetServer&#123;  
    server 192.168.238.132;  
    server 101.XXX.XXX.160;  
&#125;  
server &#123;  
    listen       82;  
    server_name  localhost;  
  
    location / &#123;  
        proxy_pass http://targetServer;  
    &#125;  
&#125;
</code></pre><p>此时默认轮询。加权，ip 哈希，热备份示意：</p><pre><code class="language-conf">upstream mysvr &#123; 
    server 127.0.0.1:7878 weight=1;
    server 192.168.10.121:3333 weight=2;
&#125;

upstream mysvr &#123; 
    server 127.0.0.1:7878; 
    server 192.168.10.121:3333;
    ip_hash;
&#125;

upstream mysvr &#123; 
    server 127.0.0.1:7878; 
    server 192.168.10.121:3333 backup;  #热备     
&#125;
</code></pre><p>还有其他策略和配置，见官方文档</p><div class="tags"><a href="/tags/Mysql/" rel="tag"><i class="ic i-tag"></i> Mysql</a> <a href="/tags/JAVA/" rel="tag"><i class="ic i-tag"></i> JAVA</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">Edited on</span> <time title="Modified: 2024-03-26 21:27:40" itemprop="dateModified" datetime="2024-03-26T21:27:40+08:00">2024-03-26</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> Donate</button><p>Give me a cup of [coffee]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.jpg" alt="ZY WeChat Pay"><p>WeChat Pay</p></div></div></div><div id="copyright"><ul><li class="author"><strong>Post author: </strong>ZY <i class="ic i-at"><em>@</em></i>世界上只有一种真正的英雄主义，就是认清了生活的真相后还依然热爱它</li><li class="link"><strong>Post link: </strong><a href="https://zyakmd.github.io/2024/03/22/%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96/" title="redis使用">https://zyakmd.github.io/2024/03/22/项目优化/</a></li><li class="license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> unless stating additionally.</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2024/03/21/Java%E7%AC%94%E8%AE%B0/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;t.mwm.moe&#x2F;fj?899870" title="Java笔记"><span class="type">Previous Post</span> <span class="category"><i class="ic i-flag"></i></span><h3>Java笔记</h3></a></div><div class="item right"></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#redis-springcache"><span class="toc-number">1.</span> <span class="toc-text">Redis + SpringCache</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%8D%E5%8A%A1%E8%BF%90%E8%A1%8C"><span class="toc-number">1.2.</span> <span class="toc-text">服务运行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%AF%E5%81%9C"><span class="toc-number">1.2.1.</span> <span class="toc-text">启停</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%8E%E5%8F%B0%E8%BF%90%E8%A1%8C"><span class="toc-number">1.2.2.</span> <span class="toc-text">后台运行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%86%E7%A0%81%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.2.3.</span> <span class="toc-text">密码校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E8%BF%9E%E6%8E%A5"><span class="toc-number">1.2.4.</span> <span class="toc-text">远程连接</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%A5%E9%94%99"><span class="toc-number">1.2.5.</span> <span class="toc-text">报错</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#java%E4%B8%AD%E4%BD%BF%E7%94%A8"><span class="toc-number">1.3.</span> <span class="toc-text">Java 中使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#jedis"><span class="toc-number">1.3.1.</span> <span class="toc-text">Jedis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#spring-data-redis"><span class="toc-number">1.3.2.</span> <span class="toc-text">Spring Data Redis</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%A1%88%E4%BE%8B"><span class="toc-number">1.4.</span> <span class="toc-text">简单案例</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E5%90%88spring-cache"><span class="toc-number">1.5.</span> <span class="toc-text">结合 spring cache</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.5.1.</span> <span class="toc-text">常用注解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">1.5.2.</span> <span class="toc-text">使用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#mysql%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6"><span class="toc-number">2.</span> <span class="toc-text">MySQL 主从复制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">2.1.</span> <span class="toc-text">配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E5%BA%93"><span class="toc-number">2.1.1.</span> <span class="toc-text">主库</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8E%E5%BA%93"><span class="toc-number">2.1.2.</span> <span class="toc-text">从库</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E5%90%88sharding-jdbc"><span class="toc-number">2.2.</span> <span class="toc-text">结合 Sharding-JDBC</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#njinx"><span class="toc-number">3.</span> <span class="toc-text">Njinx</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">3.1.</span> <span class="toc-text">目录结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nginxconf"><span class="toc-number">3.2.</span> <span class="toc-text">nginx.conf</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nginx%E5%91%BD%E4%BB%A4"><span class="toc-number">3.3.</span> <span class="toc-text">Nginx 命令</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B5%84%E6%BA%90%E4%BB%A3%E7%90%86"><span class="toc-number">3.4.</span> <span class="toc-text">资源代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">3.5.</span> <span class="toc-text">负载均衡</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="Related"></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="ZY" data-src="/images/avatar.jpg"><p class="name" itemprop="name">ZY</p><div class="description" itemprop="description">行到水穷处，坐看云起时</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">13</span> <span class="name">posts</span></a></div><div class="item categories"><a href="/categories/"><span class="count">2</span> <span class="name">categories</span></a></div><div class="item tags"><a href="/tags/"><span class="count">3</span> <span class="name">tags</span></a></div></nav><div class="social"><a href="https://github.com/zyakmd" title="https:&#x2F;&#x2F;github.com&#x2F;zyakmd" class="item github" rel="noopener" target="_blank"><i class="ic i-github"></i></a></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>Home</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>Posts</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>Random Posts</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/spring%E5%A4%8D%E4%B9%A0/" title="In spring复习">spring复习</a></div><span><a href="/2024/03/17/spring%E5%A4%8D%E4%B9%A0/SSM%E6%95%B4%E5%90%88/" title="SSM整合">SSM整合</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/03/22/%E9%A1%B9%E7%9B%AE%E4%BC%98%E5%8C%96/" title="redis使用">redis使用</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/spring%E5%A4%8D%E4%B9%A0/" title="In spring复习">spring复习</a></div><span><a href="/2024/03/15/spring%E5%A4%8D%E4%B9%A0/Spring%20MVC/" title="Spring MVC">Spring MVC</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/hexo%E4%BD%BF%E7%94%A8/" title="In hexo使用">hexo使用</a></div><span><a href="/2024/03/06/hexo%E4%BD%BF%E7%94%A8/hexo+github/" title="hexo + github 博客搭建">hexo + github 博客搭建</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/03/21/Java%E7%AC%94%E8%AE%B0/" title="Java笔记">Java笔记</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/spring%E5%A4%8D%E4%B9%A0/" title="In spring复习">spring复习</a></div><span><a href="/2024/03/20/spring%E5%A4%8D%E4%B9%A0/MyBatis%20Plus/" title="MyBatis Plus">MyBatis Plus</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/hexo%E4%BD%BF%E7%94%A8/" title="In hexo使用">hexo使用</a></div><span><a href="/2024/03/09/hexo%E4%BD%BF%E7%94%A8/%E7%95%8C%E9%9D%A2%E7%9B%B8%E5%85%B3/" title="界面相关">界面相关</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/03/13/MySQL/" title="MySQL">MySQL</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/hexo%E4%BD%BF%E7%94%A8/" title="In hexo使用">hexo使用</a></div><span><a href="/2024/03/07/hexo%E4%BD%BF%E7%94%A8/%E5%9C%A8obisidian%E4%B8%8A%E4%BD%BF%E7%94%A8/" title="在obisidian上使用">在obisidian上使用</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/spring%E5%A4%8D%E4%B9%A0/" title="In spring复习">spring复习</a></div><span><a href="/2024/03/19/spring%E5%A4%8D%E4%B9%A0/SpringBoot/" title="SpringBoot">SpringBoot</a></span></li></ul></div></div><div class="status"><div class="copyright">&copy; 2023 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-"></i> </span><span class="author" itemprop="copyrightHolder">ZY @ ZY Blog</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="Symbols count total">386k words</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="Reading time total">5:51</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2024/03/22/项目优化/",favicon:{show:"（●´3｀●）Goooood",hide:"(´Д｀)Booooom"},search:{placeholder:"Search for Posts",empty:"We didn't find any results for the search: ${query}",stats:"${hits} results found in ${time} ms"},valine:!0,fancybox:!0,copyright:'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/hijiki.model.json"},display:{position:"left",width:150,height:300},mobile:{show:!0},log:!1})</script></body></html><!-- rebuild by hrmmi -->