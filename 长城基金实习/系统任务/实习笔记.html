<!-- build time:Mon Aug 26 2024 10:26:28 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><link rel="alternate" type="application/rss+xml" title="世界上只有一种真正的英雄主义，就是认清了生活的真相后还依然热爱它" href="https://zyakmd.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="世界上只有一种真正的英雄主义，就是认清了生活的真相后还依然热爱它" href="https://zyakmd.github.io/atom.xml"><link rel="alternate" type="application/json" title="世界上只有一种真正的英雄主义，就是认清了生活的真相后还依然热爱它" href="https://zyakmd.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><link rel="canonical" href="https://zyakmd.github.io/%E9%95%BF%E5%9F%8E%E5%9F%BA%E9%87%91%E5%AE%9E%E4%B9%A0/%E7%B3%BB%E7%BB%9F%E4%BB%BB%E5%8A%A1/%E5%AE%9E%E4%B9%A0%E7%AC%94%E8%AE%B0"><title>| ZY Blog = 世界上只有一种真正的英雄主义，就是认清了生活的真相后还依然热爱它</title><meta name="generator" content="Hexo 5.4.2"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline"></h1></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">ZY Blog</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://t.mwm.moe/fj?850034"></li><li class="item" data-background-image="https://t.mwm.moe/fj?254338"></li><li class="item" data-background-image="https://t.mwm.moe/fj?818554"></li><li class="item" data-background-image="https://t.mwm.moe/fj?436423"></li><li class="item" data-background-image="https://t.mwm.moe/fj?4563"></li><li class="item" data-background-image="https://t.mwm.moe/fj?230470"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="page wrap"><article itemscope itemtype="http://schema.org/Article" class="post block" lang="en"><link itemprop="mainEntityOfPage" href="https://zyakmd.github.io/%E9%95%BF%E5%9F%8E%E5%9F%BA%E9%87%91%E5%AE%9E%E4%B9%A0/%E7%B3%BB%E7%BB%9F%E4%BB%BB%E5%8A%A1/%E5%AE%9E%E4%B9%A0%E7%AC%94%E8%AE%B0.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="ZY"><meta itemprop="description" content=", 行到水穷处，坐看云起时"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="世界上只有一种真正的英雄主义，就是认清了生活的真相后还依然热爱它"></span><div class="body md" itemprop="articleBody"><p>目录</p><h1 id="开通的账号-服务"><a class="anchor" href="#开通的账号-服务">#</a> 开通的账号、服务</h1><p>1.      微信企业<br>2.      领的笔记本（硬盘（我 6 位数）、登录密码（小写 + 数字 + 符号））<br>3.      OA 账号密码（大小写 + 数字）<br>4.      Digitalgd 邮箱密码（同上）<br>5.      VPN（<span class="exturl" data-url="aHR0cHM6Ly9zc2x2cG4uZGlnaXRhbGdkLmNvbS5jbi8lRUYlQkMlODk=">https://sslvpn.digitalgd.com.cn/）</span><br>- 政务云的：<span class="exturl" data-url="aHR0cHM6Ly8yMTAuNzYuNjQuMjQ0">https://210.76.64.244</span> : yijianyuese1!<br>6.      粤政易（密码：小写 + 数字）<br>7.      堡垒机（<span class="exturl" data-url="aHR0cHM6Ly8xOTIuMTY4LjE1Ni4xNTA=">https://192.168.156.150</span> : yijianyuese1~）<br>8.      WjqQ1wxdtPkrFkGoJvEL<br>AD 账户的默认口令</p><h1 id="概念"><a class="anchor" href="#概念">#</a> 概念</h1><p><strong>核心工作</strong>：对于 sheng 云资源，这边负责虚拟机和云服务（<strong>虚拟机、云存储、负载均衡</strong>），系统和应用（数据库，数据安全等）当地人员负责。<br>资源有外网 - 政务，互联网 - 群众。虚拟机 ip 两个，业务和管理（堡垒机）</p><p><strong>物理机</strong><br><strong>裸金属资源</strong>：完整的物理设施的服务器，但是能有完整的运维配备 + 弹性资源（？这不是虚拟化的好处吗）</p><p><strong>虚拟化服务器</strong>：抽象出来的分配资源</p><p><strong>VPC</strong>（Virtual Private Cloud）：一种虚拟专用网络服务，它允许用户在云服务器上创建自己的私有网络。适用金融、政府等。</p><p><strong>BMS</strong>（Elastic Bare Metal Server）：一种提供物理裸金属资源的计算服务，具有与传统物理服务器相同的性能和安全性。适用游戏等需要近物理机性能的业务。</p><p><strong>ECS</strong>（Elastic Compute Service）：通过虚拟技术可弹性配置的服务。</p><p>以 GaussDB 产品运维赋能材料第一期 和 广东省 “数字政府” 政务云服务指南文档 为主。</p><p><strong>GaussDB</strong>: 集中式（一主写两从备份）和分布式（三 AZ 都提供服务，且各自有 1 主 DN2 备份 DN，任意 AZ 挂了由别的 AZ 接手，各 AZ 有完整数据，可以实现无缝切换）</p><p>Q：两个数据复制方法一样吗？</p><p><strong>DDS</strong>（文档数据库）：副本集（1 主 - 读写 1 备 - 读 1 隐藏，还可以 5、7.. 节点）集群架构（路由 - 分发、配置 - 查询、分片 - 分配具体执行 组件，路由单节点，其他是三副本）</p><p><strong>TDSQL</strong>：腾讯的分布式数据库，设定 shardkey，自动基于 hash 分片，聚合查询结果。分布式的功能和性能不两全，建表方案（分布式事务、全局唯一 id、支持 JSON）。主从使用强同步，同步成功了才能给予事务应答。（还有非事务应答？）</p><p>Q：聚合查询怎么实现的？统一放到一个节点处理？  分布式都是用事务处理？</p><p>TBASE：腾讯在 PG 基础上的</p><p>TBDS：腾讯大数据处理套件</p><p>TKE（Tencent Kubernetes Engine）：容器服务，日志处理的时候有用 kafaka 队列，还涉及微服务，每个服务用 docker</p><p>TSF：微服务平台，需要客户提供 TKE 集群资源，或者 Iaas 虚拟机。围绕应用或微服务的 Paas 平台。有 Spring Cloud 和 Service Mesh。</p><p>CMQ：分布式消息队列。异步通信、支持多线程读写，有队列和主题两种模式。https 保证安全，Raft 算法保证三副本持久化</p><p>云计算有三种服务模型：基础设施即服务（IaaS，弹性计算云服务，白板资源？）、平台即服务（PaaS，提供了一个开发和部署应用程序的平台，其中包括操作系统、中间件、开发工具、数据库和运行时环境等，中间件和环境抽象优化，涉及到 docker 之类隔离部署中间件？）和软件即服务（SaaS，最高层服务，如云办公套件，提供成品云服务）</p><p>读取 mysql 的一个表，读取的表，读取的字段，再读取 pg 的表</p><h1 id="day1"><a class="anchor" href="#day1">#</a> Day1</h1><p>在本机</p><h1 id="day2"><a class="anchor" href="#day2">#</a> Day2</h1><h2 id="gaussdb组件关系"><a class="anchor" href="#gaussdb组件关系">#</a> GaussDB 组件关系</h2><p>・DBS Console：面向最终租户的实例管理 Web 控制台，租户通过该界面可以自助完成数据库实例的 管理。</p><p>・APIGW：面向最终租户的实例管理 Open API，租户可以通过调用这些 API 完成数据库实例管理。</p><p>・DBS Service：数据库服务管理与控制系统，负责数据库实例所有管理功能，对外统一提供 RESTful 风格的 API。</p><p>・ManageOne 运营：提供 VDC（Virtual Data Center）管理、权限管理、产品管理、订单、计费管理等一系列运营能力。</p><p>・ManageOne 运维：提供基础运维服务，集成了告警、性能监控、服务监控、日志下载、统一密 码、资源监控等能力。</p><p>・RegionLB：公有云管理面 API 调用的统一负载均衡器，所有来自 Console 或 APIGW 的调用，都首先 到 RegionLB，再由其分发到对应的服务。</p><p>・SDR：计费系统及话单 FTP 服务器，计费系统负责对租户使用的资源进行计费，服务负责把资源数 据形成话单文件，并保存到 FTP 服务器，再由计费系统从中读取。</p><p>・NTP：提供时钟同步能力，数据库管理面和数据库业务面均依赖该服务进行时钟同步。</p><p>・CTS：管理面 API 调用审计日志，DBS 的所有 API 调用日志都将存入 CTS，以便进行审计、追踪。</p><p>・DNS：提供域名解析服务，数据库服务依赖 DNS 解析依赖组件的域名。</p><p>・OBS：对象存储服务，用于存储租户数据库所有备份数据，以及管理面自身的备份数据。・CES：DBS 支持数据库实例的多种监控指标查看，实例上报指标至管控面，再由管控面组件同步到 CES，并在其中提供统一的查看界面，HCS 场景下 CES 被 ManageOne OC 性能监控纳管。</p><p>・IaaS+：ECS/EVS/VPC/OpenStack 提供计算、存储和网络虚拟资源，DBS 基于此允许数据库实例对 外提供数据库服务。</p><p>ServiceOM: 集成了计算、存储、网络以及数据库运维管理平台服务，提供专业运维能力。</p><p>DBS OPS：提供数据库服务专业运维能力，有实例管理、节点管理、任务管理、配置管理、实例 巡检、实例监控等数据库专业运维能力</p><h3 id="思考"><a class="anchor" href="#思考">#</a> 思考</h3><p>-  看上面的组件联系突然想到之前面试的保障问题，首先肯定是监控（性能、服务、资源）过了一定阈值又有告警，这些都记录在日志（又有数据库操作日志，接口调用日志等等），回头排查。</p><p>- 分布式数据库时间问题，多管理还是得抽象，CN 对应 DN，路由对应 CN 等，都是选取一个作为判断，这里就是 NTP 时间同步</p><h2 id="gaussdb运维分享文档学习"><a class="anchor" href="#gaussdb运维分享文档学习">#</a> GaussDB 运维分享文档学习</h2><h3 id="部署"><a class="anchor" href="#部署">#</a> 部署</h3><p>主备物理复制，数据同步的模式：</p><p><strong>最大保护模式</strong></p><p>①LOG 归档的备机地址 ARCHIVE_DEST_n（n 不等于 1），至少有一个备机的 Redo 日志传输模式必须配置为同步模式 SYNC，如果所有的备机都配置为异步模式 ASYNC，数据库会启动失败。</p><p>②如果 LOG 归档的备机地址 ARCHIVE_DEST_n（n 不等于 1）指定了 SYNC 和 AFFIRM 属性，那么事务日志写入所有指定 AFFIRM 的备库日志文件后，才会在主库上提交。</p><p>③如果 LOG 归档的备机地址 ARCHIVE_DEST_n（n 不等于 1）指定了 SYNC 和 NAFFIRM 属性，那么无需等待备机写入，事务日志将直接写入主库。</p><p><strong>最大可用模式</strong></p><p>①如果 LOG 归档的备机地址 ARCHIVE_DEST_n（n 不等于 1）指定了 SYNC 和 AFFIRM 属性，且指定了 AFFIRM 的备机和主机连接正常时，那么事务日志写入所有指定 AFFIRM 的备库日志文件后，才会在主库上提交。</p><p>②如果 LOG 归档的备机地址 ARCHIVE_DEST_n（n 不等于 1）指定了 SYNC 和 NAFFIRM 属性，那么无需等待备机写入，事务日志将直接写入主库。</p><p><strong>最大性能模式</strong></p><p>默认，但无保护，生产环境不建议使用</p><p><strong>一主两备</strong></p><p>如果是一主两备的情况，需要在每台机器上都建立两条复制通道，每台机器设置 log_archive_dest_2 和 log_archive_dest_3，记得重启数据库，这样在主备切换后备库会自动连到新的主库。</p><p><strong>分布式部署</strong>：</p><p><strong>主备部署</strong>：</p><h3 id="运营面"><a class="anchor" href="#运营面">#</a> 运营面</h3><p>类似云服务器平台 管理实例，有管理、备份、日志、参数、连接修改等；备份恢复、任务中心、回收站、容灾管理等</p><h3 id="日常运维"><a class="anchor" href="#日常运维">#</a> 日常运维</h3><p>主要是组件关系中的运维那块，分为监控、资源调度、巡检调测三个模块</p><p>然后具体的 one 管理平台，又是那种可视化管理平台，点点点么？</p><p>其中有个任务是巡检。</p><h3 id="内核升级"><a class="anchor" href="#内核升级">#</a> 内核升级</h3><p>升级过程涉及系统表和数据表变更，重启进程，有版本兼容风险和业务中 断问题，用户需要根据自己业务特性选择相应的升级方案。</p><p>1， 就地升级</p><p>业务暂停大概 30 分钟，交给 GaussDB 自主升级。高可靠，数据盘使用率不得高于阈值 - 10%，升级自动提交，失败自动回退</p><p>2， 灰度升级</p><p>首先使用 SQL 在线对系统对象进行升。重启二进制切换升进行升级。支持升级自动提交和升级待观察两种操作方式。</p><p>一次升级所有节点，存在风险，万一故障，业务不用</p><p>3， 滚动升级</p><p>先升级 etcd，cms 节点，再升级 DN 分片，分片内滚动升级，再依次滚动升级 cn，gtm。所有滚动升级均为由备至主。</p><p>分片升级则会断网 5 秒一次，导致 整个升级过程会断网多次。并且升级时 间比较长。 每个分片 进程重启 二进 制替换，只影响该分片业务中断，jdbc 负载均衡与重试机制。可能造成业务卡顿，在上层应用处理？适用于大规模多分片集群，升级待观察，确认提交。</p><p>4， 热补丁升级</p><p>升级自动提交：热补丁自动升级并提交，以 patch 格式，内存加载热补丁，不需要重启进程，无业务中断，中间无业务中断。</p><p>升级回退：热补丁回退，无业务中断时间。</p><h3 id="gaussdb改名"><a class="anchor" href="#gaussdb改名">#</a> GaussDB 改名</h3><p>出现了组件名称变动？</p><h2 id="产品文档分布式"><a class="anchor" href="#产品文档分布式">#</a> 产品文档（分布式）</h2><p>看到 - 进入沙箱操作指导</p><h1 id="day3"><a class="anchor" href="#day3">#</a> Day3</h1><p><strong>糗大了，不是在 OA 平台申请，开通了个无用的，也不知道有没有影响</strong></p><p>堡垒机自己申请下看看？</p><p>在 Dg home 中会发现堡垒机还未申请</p><p>点击即可跳转到如下表单，填写并提交申请：</p><p><strong>Region</strong>：在 Region 这个概念上公有云和私有云是一致的，都是指地理上的区域，差别只在于公有云的范围较大，公有云的一个 Region 可能跨越了几个省份，覆盖多个数据中心，一个 Region 就具备了除灾备外的绝大部分能力；</p><p><strong>AZ</strong>：AZ 是 Availability Zone 的缩写，是指一个故障隔离域，一个 AZ 的电力、冷却等都是独自使用的，这里面公有云的 AZ 的规模包含多个 DC，而私有云或者混合云的 AZ 规模一般是几个机柜</p><p><strong>POD</strong>：这个概念光是全拼都看到几种，到底是啥仁者见仁，感觉比较靠谱的是 Point of Delivery 即交付单元，是指数据中心模块化的建设单元，通常是模块化、可复用、有配套设施和标准化网络。POD 这个概念多出现于公有云，私有云和混合云较少使用 POD 这个概念。</p><h2 id="备份"><a class="anchor" href="#备份">#</a> 备份</h2><p><strong>主备模式的备会因同步主操作，若有不当数据删库，无法靠备机恢复，因此需要备份</strong></p><p>1. <strong>全量备份</strong></p><ul><li><strong>优点</strong>：恢复数据时简单直接，只需一盘磁带或一份备份文件，大大节省了恢复时间；是特定时间点所有数据的全面快照，确保数据的完整性；管理员可以轻松管理版本控制，避免数据混乱。</li><li>缺点：备份需要很长时间才能完成，因为它们会创建系统中每个文件的副本；需要大量的存储空间，随着管理员重复复制相同的文件，很快就会变得多余；资源密集型操作，可能会影响网络性能。</li></ul><p>2. <strong>增量备份</strong></p><ul><li><strong>优点</strong>：执行速度快，仅复制自上次备份以来更改的数据，节省大量时间和存储空间 [<sup>3</sup>]；如果团队经常更改数据，则是理想选择，适合维护最新备份的压力大的情况 [<sup>1</sup>]。</li><li><strong>缺点</strong>：恢复过程复杂且耗时，需要依次恢复全量备份及其后的多个增量备份文件 [<sup>2</sup>]；如果其中一个备份出现问题，则可能会丢失一些数据 [<sup>3</sup>]。</li></ul><p>3. <strong>差异备份</strong></p><ul><li><strong>优点</strong>：节省存储空间，因为只备份自上次完全备份以来的更改 [<sup>3</sup>]；恢复数据时只需要最近的全量备份和一个差异备份，减少恢复复杂度 [<sup>2</sup>]。</li><li><strong>缺点</strong>：如果频繁更改数据集，差异备份会变得庞大且缓慢 [<sup>3</sup>]；恢复数据时必须首先恢复完整备份，然后应用最新的差异备份 [<sup>1</sup>]。</li></ul><p>4. <strong>镜像备份</strong></p><ul><li><strong>优点</strong>：提供对操作系统、应用程序和数据的完全恢复能力，适用于需要快速恢复整个系统的场景 [<sup>3</sup>]；通过高速光纤通道线路和磁盘控制技术实现数据的即时备份 [<sup>1</sup>]。</li><li><strong>缺点</strong>：需要较高的网络带宽和存储资源，同时在同步更新时可能会影响系统性能 [<sup>3</sup>]；不支持版本控制或历史数据恢复，如果主数据被误删除或覆盖，镜像备份中的数据也会受到影响 [<sup>3</sup>]。</li></ul><p>5. <strong>实时备份</strong></p><ul><li>优点：最大程度地减少数据丢失的风险，确保数据的实时性和准确性 [<sup>2</sup>]；能够检测到字节级的变化，提高数据的实时性，实现零丢失 [<sup>4</sup>]。</li><li><strong>缺点</strong>：需要高频率的备份操作和大量的存储空间，对备份系统的实时性和稳定性要求较高 [<sup>4</sup>]。</li></ul><p>6. <strong>多地备份</strong></p><ul><li><strong>优点</strong>：防止单点故障和地域性灾难对数据的影响，提升数据安全性和灾难恢复能力 [<sup>4</sup>]；将数据分散存储在多个地理位置的节点上，提高数据的可靠性和可用性 [<sup>1</sup>]。</li><li><strong>缺点</strong>：管理和维护多地备份系统较为复杂，需要协调不同地点的存储和网络资源 [<sup>4</sup>]</li></ul><p><strong>GUC：</strong><a target="_blank" rel="noopener" href="https://support.huaweicloud.com/devg-dws/dws_04_0885.html">**GaussDB (DWS)**<strong> 数据库中的一种对数据库变量进行设置的机制</strong></a>，简单讲就是一个参数合集，有很多管理数据库的参数，调整日志，延时等等很多。</p><h2 id="get"><a class="anchor" href="#get">#</a> Get：</h2><p>-       主备也是需要颠倒的，可能要上下电啥的</p><p>-       日志信息具体会有：事务、读写等记录；死锁、慢 SQL 等记录；性能占用情况，负载情况，IO 情况，命中率等；各种索引，执行情况的统计</p><p>-       数据库出问题，主要是从运行日志获取信息，一般不超过七天，选择时间段指日志文件最后归档时间。</p><h1 id="可用点"><a class="anchor" href="#可用点">#</a> 可用点</h1><p>-       部署模式（主备集中式、分布式）</p><p>-       慢 SQL 处理：查看后台有无 SQL 语句执行时间过长，结束其保障其他。进沙盒 -》查指令状态 -》连接数据库 -》SELECT * FROM pg_stat_activity; -》SELECT pg_terminate_backend (对应 SQL 的 pid);</p><p>n  定位：Explain 执行计划。关联查询的执行顺序<br>查询操作的操作类型<br>哪些索引可以被命中<br>哪些索引实际被命中<br>每张表有多少记录参与查询</p><p>n  Cost  = Server Cost + Engine Cost<br>= CPU Cost + IO Cost</p><p>n  慢查日志等定位那些执行效率较低的 SQL 语句。Type（全表、索引）、rows、filtered、extra</p><p>-       多种备份</p><h1 id="day4"><a class="anchor" href="#day4">#</a> Day4</h1><p>看运维栈群的公告文件 + codewd。堡垒机下来了的话就开始干活</p><p>看文档 + 写了个两个数据库分段查询脚本</p><p>脚本需求:</p><p>根据实例 id 在 mysql 库查询目标 ip、port（元组形式），解包后再通过其在 PG 数据库查询需要的信息，平均，最后一条等。打印并保存。</p><p>其中配置信息通过 yaml 文件实现解耦。</p><h1 id="day5"><a class="anchor" href="#day5">#</a> Day5</h1><p>上午请假开会<br>下午学习运维知识：shell 自动化脚本</p><p>达荣哥指示：<br>看 gaussDB、dds 的公有云产品文档<br><span class="exturl" data-url="aHR0cHM6Ly9zdXBwb3J0Lmh1YXdlaWNsb3VkLmNvbS9xcy1nYXVzc2RiL2dhdXNzZGJfMDFfMDc1Lmh0bWw=">操作指引_云数据库 GaussDB (huaweicloud.com)</span><br><span class="exturl" data-url="aHR0cHM6Ly9zdXBwb3J0Lmh1YXdlaWNsb3VkLmNvbS9kZHMvaW5kZXguaHRtbA==">成长地图_文档数据库服务 DDS (huaweicloud.com)</span></p><p>![[企业微信截图_17207747554756.png]]<br>装个 VMware 练手 linux<br><span class="exturl" data-url="aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vaGVsbG9nbXkvcC8xNzI1MzA0MS5odG1s">VMware 17 下载安装及永久激活使用教程 - 嘿笨笨熊 - 博客园 (cnblogs.com)</span></p><h1 id="day6"><a class="anchor" href="#day6">#</a> Day6</h1><h2 id="tdsql"><a class="anchor" href="#tdsql">#</a> TDSQL</h2><p>兼容 MySQL 的自主可控的、高一致性、分布式的数据库产品。持自动水平拆分，业务感受完 整的逻辑表，怎么实现的？<br>然而并没有说，自己找了些，见开发准备</p><p>一些共性的点：使用 kafufa 处理日志进行备份 / 同步，可能是速度快？</p><ul><li>问题：<ul><li>网络：类似 java 的 Netty。实现了用也是 Reacotr 模型的自己的 RPC 架构，主要分为三个角色<ul><li>Reactor：把 IO 事件分配给对应的 handler 处理</li><li>Acceptor：处理客户端连接事件</li><li>Handler：处理非阻塞的任务</li><li>对于多连接问题用线程池处理，对于连接后阻塞等待数据的问题，多个连接公用一个阻塞对象（IO 多路复用）</li></ul></li><li>磁盘：相比 redis 内存用了磁盘，采用 <code>顺序写</code> 文件，基本减少了磁盘 <code>寻道</code> 和 <code>旋转</code> 的次数。Kafka 中每个分区是一个有序的，不可变的消息序列，新的消息不断追加到 Partition 的末尾（分为多个 Segment，每个 Segment 对应一个物理文件，直接追加写）。<em><strong>原理</strong></em>：Kafka 就是一个 <code>Queue</code> ，FIFO。而 redis 是 hashmap，随机读写。<ul><li>topic 对消息分区，分区日志在物理上按大小分为多个 segment，对文件后缀做了索引映射（快速定位物理地址）</li></ul></li><li>复杂度：普通流程，数据要从系统 - 应用 - socket - 网卡，四步。Kafka 使用到了 <code>mmap</code> 和 <code>sendfile</code> 的方式来实现 <code>零拷贝</code> 。分别对应 Java 的 <code>MappedByteBuffer</code> 和 <code>FileChannel.transferTo</code> （跳过了陷入内核态的开销）</li></ul></li><li>解决方向：<ul><li><strong>并发</strong>：分区并发（Group、partition），内存占用↑、恢复时间↑</li><li><strong>压缩：</strong>（Producer、Broker 和 Consumer 使用相同的压缩算法，在 producer 向 Broker 写入数据，Consumer 向 Broker 读取数据时甚至可以不用解压缩，最终在 Consumer Poll 到消息时才解压，这样节省了大量的网络和磁盘开销。）</li><li><strong>批量</strong></li><li><strong>缓存</strong></li><li><strong>算法</strong><br>最高安全都是保证强一致性，都是确保主从都写成了才算成功。</li></ul></li></ul><h2 id="dds-mongodb"><a class="anchor" href="#dds-mongodb">#</a> DDS、mongoDB</h2><h1 id="工作"><a class="anchor" href="#工作">#</a> 工作</h1><p>1、确认已经提单申请了进场，根据单号日常催单（vpn、账号等开通需要时间）；<br>2、了解产品资源提单、实施流程、交付材料，熟悉产品运维文档；<br>3、了解资源建设、分配情况，掌握定位资源位置的关键技巧；<br>4、登录环境，熟悉产品管理页面，清楚判断客户侧的权限、运维侧的权限；<br>5、根据现有方案进行巡检、演练操作，输出对应报告；<br>6、协助客户遇到的使用问题</p><h2 id="每日汇报"><a class="anchor" href="#每日汇报">#</a> 每日汇报</h2><h3 id="学习到的"><a class="anchor" href="#学习到的">#</a> 学习到的</h3><ol><li>政务云指南文档、申请文档大致浏览了</li><li>你之前发的 gaussDB 的邮件，“云数据库 GaussDB 2.23.01.210 产品文档 (分布式) 01” 对应内容过了</li><li>金超姐群里发的 “TDSQL 交接资料” 看了：启动操作、TDSQL 架构、巡检工具指引（天巡组件和手动）、告警管理、演练报告</li></ol><h2 id="进行中的"><a class="anchor" href="#进行中的">#</a> 进行中的</h2><ol><li>“TDSQL 交接资料”</li><li>“国产云 PaaS 资源创建手册 &quot;</li></ol><h3 id="问题"><a class="anchor" href="#问题">#</a> 问题</h3><ol><li>堡垒机内还是连不上 <span class="exturl" data-url="aHR0cDovL3lqei5nZGdvdi5jbg==">yjz.gdgov.cn</span>（是还要跳板机吗？）</li><li>各个登录平台的关系以及工作流程，是否这样理解：<ul><li>业务 / 工单 都会在上面这个粤基座的平台（政务云）处理，但实际操作，比如帮 x 客户的 gaussDB 扩容，就要查客户的 ip、端口，我们自己登录 manageone 这种管理平台进行处理，完成后（结果截图）在粤基座完成工单？</li></ul></li></ol><h2 id="运维知识学习"><a class="anchor" href="#运维知识学习">#</a> 运维知识学习</h2><p><img data-src="https://img-blog.csdnimg.cn/5acd6f4ef4f94cc18d041e1e7b963e1e.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBA5LqS6IGU572R6ICB6L6b,size_20,color_FFFFFF,t_70,g_se,x_16" alt="111"></p><h3 id="协议"><a class="anchor" href="#协议">#</a> 协议</h3><p>Ssh：实现安全远程登录以及其它安全网络服务。</p><p>那就涉及到安全问题，经典的对称加密，存在密钥泄露。到非对称也就是 https 采用的，私钥自己保留，但存在扮演中间人模仿 s 端获得 c 端的登录信息等。所以有 CA（证书）确保 c 端收到的是 s 端的公钥。</p><p>可是 SSH 的 publish key 和 private key 都是自己生成的，没法公证。只能通过 Client 端自己对公钥进行确认。</p><p>基于口令：就是有提示，自己确认的那个步骤</p><p>公钥确认：github 当时搭博客的时候就是这么处理的，将 c 的公钥放到 s 端</p><ol><li>Client 将自己的公钥存放在 Server 上，追加在文件 authorized_keys 中。</li><li>Server 端接收到 Client 的连接请求后，会在 authorized_keys 中匹配到 Client 的公钥 pubKey，并生成随机数 R，用 Client 的公钥对该随机数进行加密得到 pubKey (R) ，然后将加密后信息发送给 Client</li><li>Client 端通过私钥进行解密得到随机数 R，然后对随机数 R 和本次会话的 SessionKey 利用 MD5 生成摘要 Digest1，发送给 Server 端</li><li>Server 端会也会对 R 和 SessionKey 利用同样摘要算法生成 Digest2</li><li>Server 端会最后比较 Digest1 和 Digest2 是否相同，完成认证过程。</li></ol><p>本质都是要保证公钥的有效性。</p><h3 id="shell脚本自动化"><a class="anchor" href="#shell脚本自动化">#</a> Shell 脚本自动化</h3><h4 id="系统管理与维护脚本"><a class="anchor" href="#系统管理与维护脚本">#</a> 系统管理与维护脚本</h4><p><strong>脚本要求：</strong></p><p>系统信息收集： 收集系统的基本信息，包括操作系统版本、内核版本、CPU 信息、内存信息、磁盘使用情况等。</p><p>日志清理： 定期清理系统日志文件，避免日志文件过大占用磁盘空间。</p><p>定时任务检查： 检查系统中是否存在定时任务，记录定时任务的执行情况。</p><p>服务状态检查： 检查系统中运行的服务状态，包括启动状态、运行状态等。</p><p>安全性检查： 检查系统的安全性配置，包括防火墙设置、登录安全策略等。</p><p>异常情况处理： 当发现异常情况时，及时记录并发送通知，方便管理员处理。</p><p><strong>实现思路：</strong></p><p>系统信息收集： 使用系统命令（如 uname、cat /proc/cpuinfo、free -m、df -h 等）收集系统信息，将结果输出到日志文件。</p><p>日志清理： 使用 find 命令定期清理日志文件，可以设置脚本定时执行。</p><p>定时任务检查： 使用 crontab -l 命令获取系统中的定时任务信息，记录到日志文件中。</p><p>服务状态检查： 使用 systemctl status &lt;service&gt; 命令检查各个服务的状态，记录到日志文件中。</p><p>安全性检查： 使用 iptables -L、sshd -T 等命令检查防火墙设置和 SSH 安全策略，记录到日志文件中。</p><p>异常情况处理： 使用 if 语句判断各项检查结果是否正常，如果异常则记录到日志文件中，并发送通知邮件给管理员。</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token shebang important">#!/bin/bash</span></pre></td></tr><tr><td data-num="2"></td><td><pre> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 1. 系统信息收集</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">"System Information:"</span> <span class="token operator">>></span> system_report.log</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">"OS Version: <span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-a</span><span class="token variable">)</span></span>"</span> <span class="token operator">>></span> system_report.log</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">"Kernel Version: <span class="token variable"><span class="token variable">$(</span><span class="token function">uname</span> <span class="token parameter variable">-r</span><span class="token variable">)</span></span>"</span> <span class="token operator">>></span> system_report.log</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">"CPU Info: <span class="token variable"><span class="token variable">$(</span><span class="token function">cat</span> /proc/cpuinfo<span class="token variable">)</span></span>"</span> <span class="token operator">>></span> system_report.log</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">"Memory Info: <span class="token variable"><span class="token variable">$(</span><span class="token function">free</span> <span class="token parameter variable">-m</span><span class="token variable">)</span></span>"</span> <span class="token operator">>></span> system_report.log</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">"Disk Usage: <span class="token variable"><span class="token variable">$(</span><span class="token function">df</span> <span class="token parameter variable">-h</span><span class="token variable">)</span></span>"</span> <span class="token operator">>></span> system_report.log</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># 2. 日志清理（假设每周清理一次）</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># 删除 `/var/log` 目录下查找所有扩展名为 `.log` 的修改时间超过七天的文件</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># `-exec rm -rf &#123;&#125; \;` 对每个找到的文件执行 `rm -rf` 命令，其中 `&#123;&#125;` 会被替换为当前找到的文件的路径，\; 是结束符号</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token function">find</span> /var/log <span class="token parameter variable">-name</span> <span class="token string">"*.log"</span> <span class="token parameter variable">-mtime</span> +7 <span class="token parameter variable">-exec</span> <span class="token function">rm</span> <span class="token parameter variable">-rf</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre> </pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment"># 3. 定时任务检查（Crontab 定时任务）</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">"Cron Jobs:"</span> <span class="token operator">>></span> system_report.log</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token function">crontab</span> <span class="token parameter variable">-l</span> <span class="token operator">>></span> system_report.log</pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment"># 4. 服务状态检查</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">"Service Status:"</span> <span class="token operator">>></span> system_report.log</pre></td></tr><tr><td data-num="21"></td><td><pre>systemctl status apache <span class="token operator">>></span> system_report.log</pre></td></tr><tr><td data-num="22"></td><td><pre>systemctl status sshd <span class="token operator">>></span> system_report.log</pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token comment"># 5. 安全性检查</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">"Firewall Configuration:"</span> <span class="token operator">>></span> system_report.log</pre></td></tr><tr><td data-num="26"></td><td><pre>iptables <span class="token parameter variable">-L</span> <span class="token operator">>></span> system_report.log</pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">"SSH Configuration:"</span> <span class="token operator">>></span> system_report.log</pre></td></tr><tr><td data-num="28"></td><td><pre>sshd <span class="token parameter variable">-T</span> <span class="token operator">>></span> system_report.log</pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token comment"># 6. 异常情况处理（示例：如果服务 apache2 状态异常，则发送邮件通知管理员）</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token keyword">if</span> systemctl status apache2 <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">"Active: active (running)"</span> <span class="token operator">></span>/dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token builtin class-name">echo</span> <span class="token string">"Apache2 is running normally."</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token keyword">else</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token builtin class-name">echo</span> <span class="token string">"Apache2 is not running. Sending notification to admin..."</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    mail <span class="token parameter variable">-s</span> <span class="token string">"Apache2 Service Alert"</span> admin@example.com <span class="token operator">&lt;&lt;&lt;</span> <span class="token string">"Apache2 service is not running on <span class="token variable"><span class="token variable">$(</span><span class="token function">hostname</span><span class="token variable">)</span></span>. Please check."</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token keyword">fi</span></pre></td></tr><tr><td data-num="37"></td><td><pre> </pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token comment"># 结束</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">"System maintenance report generated."</span></pre></td></tr></table></figure><h5 id="crontab"><a class="anchor" href="#crontab">#</a> crontab</h5><p><code>crontab -e -l -r</code> 编辑、查看、删除当前用户的 crontab 文件</p><p>具体命令：</p><figure class="highlight shell"><figcaption data-lang="Bash"><span>l</span></figcaption><table><tr><td data-num="1"></td><td><pre>*    *    *    *    *</pre></td></tr><tr><td data-num="2"></td><td><pre>-    -    -    -    -</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">|</span>    <span class="token operator">|</span>    <span class="token operator">|</span>    <span class="token operator">|</span>    <span class="token operator">|</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">|</span>    <span class="token operator">|</span>    <span class="token operator">|</span>    <span class="token operator">|</span>    +----- 星期中星期几 <span class="token punctuation">(</span><span class="token number">0</span> - <span class="token number">6</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>星期天 为0<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">|</span>    <span class="token operator">|</span>    <span class="token operator">|</span>    +---------- 月份 <span class="token punctuation">(</span><span class="token number">1</span> - <span class="token number">12</span><span class="token punctuation">)</span> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">|</span>    <span class="token operator">|</span>    +--------------- 一个月中的第几天 <span class="token punctuation">(</span><span class="token number">1</span> - <span class="token number">31</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">|</span>    +-------------------- 小时 <span class="token punctuation">(</span><span class="token number">0</span> - <span class="token number">23</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre>+------------------------- 分钟 <span class="token punctuation">(</span><span class="token number">0</span> - <span class="token number">59</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">0</span> */2 * * * /sbin/service httpd restart  意思是每两个小时重启一次apache </pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token number">50</span> <span class="token number">7</span> * * * /sbin/service sshd start  意思是每天7：50开启ssh服务 </pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">50</span> <span class="token number">22</span> * * * /sbin/service sshd stop  意思是每天22：50关闭ssh服务 </pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token number">0</span> <span class="token number">0</span> <span class="token number">1,15</span> * * <span class="token function">fsck</span> /home  每月1号和15号检查/home 磁盘 </pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token number">1</span> * * * * /home/bruce/backup  每小时的第一分执行 /home/bruce/backup这个文件 </pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>00 03 * * <span class="token number">1</span>-5 <span class="token function">find</span> /home <span class="token string">"*.xxx"</span> <span class="token parameter variable">-mtime</span> +4 <span class="token parameter variable">-exec</span> <span class="token function">rm</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span><span class="token punctuation">;</span>  每周一至周五3点钟，在目录/home中，查找文件名为*.xxx的文件，并删除4天前的文件。</pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token number">30</span> <span class="token number">6</span> */10 * * <span class="token function">ls</span>  意思是每月的1、11、21、31日是的6：30执行一次ls命令</pre></td></tr></table></figure><p>结合起来</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>crontab <span class="token operator">-</span>e</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">59</span> <span class="token number">23</span> <span class="token operator">*</span> <span class="token operator">*</span> <span class="token operator">*</span> <span class="token operator">/</span>home<span class="token operator">/</span>john<span class="token operator">/</span>bin<span class="token operator">/</span>backup<span class="token punctuation">.</span><span class="token property-access">sh</span></pre></td></tr></table></figure><p>检查 /var/log/cron 文件</p><figure class="highlight javascript"><figcaption data-lang="javascript"></figcaption><table><tr><td data-num="1"></td><td><pre>$ tail <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>log<span class="token operator">/</span>cron</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token maybe-class-name">Oct</span>  <span class="token number">8</span> <span class="token number">22</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> dev<span class="token operator">-</span>db crond<span class="token punctuation">[</span><span class="token number">18340</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">(</span>root<span class="token punctuation">)</span> <span class="token constant">CMD</span> <span class="token punctuation">(</span><span class="token operator">/</span>bin<span class="token operator">/</span>sh <span class="token operator">/</span>home<span class="token operator">/</span>root<span class="token operator">/</span>bin<span class="token operator">/</span>system_check <span class="token operator">&amp;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token maybe-class-name">Oct</span>  <span class="token number">8</span> <span class="token number">23</span><span class="token operator">:</span><span class="token number">00</span><span class="token operator">:</span><span class="token number">00</span> dev<span class="token operator">-</span>db crond<span class="token punctuation">[</span><span class="token number">20348</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">(</span>oracle<span class="token punctuation">)</span> <span class="token constant">CMD</span> <span class="token punctuation">(</span><span class="token operator">/</span>bin<span class="token operator">/</span>sh <span class="token operator">/</span>home<span class="token operator">/</span>oracle<span class="token operator">/</span>bin<span class="token operator">/</span>cleanup<span class="token punctuation">.</span><span class="token property-access">sh</span> <span class="token operator">&amp;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token maybe-class-name">Oct</span>  <span class="token number">8</span> <span class="token number">23</span><span class="token operator">:</span><span class="token number">59</span><span class="token operator">:</span><span class="token number">00</span> dev<span class="token operator">-</span>db crond<span class="token punctuation">[</span><span class="token number">20399</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">(</span>john<span class="token punctuation">)</span> <span class="token constant">CMD</span> <span class="token punctuation">(</span><span class="token operator">/</span>bin<span class="token operator">/</span>sh <span class="token operator">/</span>home<span class="token operator">/</span>john<span class="token operator">/</span>bin<span class="token operator">/</span>backup<span class="token punctuation">.</span><span class="token property-access">sh</span> <span class="token operator">&amp;</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h5 id="systemctl"><a class="anchor" href="#systemctl">#</a> systemctl</h5><p><code>systemctl</code>  是 Linux 系统上用于控制系统和服务管理器的命令行工具</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 显示指定服务的状态信息，包括是否正在运行、进程 ID、最近的日志条目等</span></pre></td></tr><tr><td data-num="2"></td><td><pre>systemctl status 服务名</pre></td></tr><tr><td data-num="3"></td><td><pre>systemctl start 服务名</pre></td></tr><tr><td data-num="4"></td><td><pre>systemctl stop 服务名</pre></td></tr><tr><td data-num="5"></td><td><pre>systemctl restart 服务名</pre></td></tr><tr><td data-num="6"></td><td><pre>systemctl <span class="token builtin class-name">enable</span> 服务名 <span class="token comment"># 启动时自启</span></pre></td></tr><tr><td data-num="7"></td><td><pre>systemctl disable 服务名 <span class="token comment"># 启动时不启</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># 列出所有服务</span></pre></td></tr><tr><td data-num="9"></td><td><pre>systemctl list-units <span class="token parameter variable">--type</span><span class="token operator">=</span>service</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment"># 查看服务的日志信息</span></pre></td></tr><tr><td data-num="11"></td><td><pre>systemctl status 服务名 <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">'Active:'</span> <span class="token parameter variable">-A100</span></pre></td></tr></table></figure><h5 id="bash中的逻辑判断"><a class="anchor" href="#bash中的逻辑判断">#</a> bash 中的逻辑判断</h5><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">if</span> systemctl status apache2 <span class="token operator">|</span> <span class="token function">grep</span> <span class="token parameter variable">-q</span> <span class="token string">"Active: active (running)"</span><span class="token punctuation">;</span> <span class="token keyword">then</span> <span class="token builtin class-name">echo</span> <span class="token string">"Apache2 is running."</span> <span class="token keyword">else</span> <span class="token builtin class-name">echo</span> <span class="token string">"Apache2 is not running."</span> <span class="token keyword">fi</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre>命令的退出状态是一个 <span class="token number">0</span> 到 <span class="token number">255</span> 之间的整数值，其中 <span class="token number">0</span> 通常表示成功（或“真”），而非零值表示发生了某种错误或条件未满足（即“假”）。</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>当 <span class="token variable"><span class="token variable">`</span><span class="token function">grep</span> <span class="token parameter variable">-q</span> <span class="token string">"Active: active (running)"</span><span class="token variable">`</span></span> 成功找到至少一个匹配项时，它会立即退出并返回状态码 <span class="token number">0</span>。这个 <span class="token number">0</span> 状态码随后被 <span class="token variable"><span class="token variable">`</span><span class="token keyword">if</span><span class="token variable">`</span></span> 语句捕获，并导致 <span class="token variable"><span class="token variable">`</span><span class="token keyword">if</span><span class="token variable">`</span></span> 语句的 <span class="token variable"><span class="token variable">`</span><span class="token keyword">then</span><span class="token variable">`</span></span> 分支被执行。</pre></td></tr></table></figure><h4 id="文件操作脚本"><a class="anchor" href="#文件操作脚本">#</a> 文件操作脚本</h4><p><strong>脚本要求</strong>：<br>文件备份： 给定一个文件路径，将该文件备份到指定目录，并在备份文件名中添加当前日期时间。<br>文件压缩： 给定一个目录路径，将该目录下的所有文件压缩成一个压缩文件。<br>文件查找： 给定一个目录路径和关键字，查找该目录下包含关键字的所有文件。<br>文件比较： 给定两个文件路径，比较两个文件的内容是否相同。<br>文件权限设置： 给定一个文件路径和权限值，设置该文件的权限。<br>异常处理： 当发生异常情况时，及时记录并给出相应提示。</p><p><strong>实现思路</strong>：<br>文件备份： 使用 cp 命令复制文件到指定目录，并在文件名中添加当前日期时间。<br>文件压缩： 使用 tar 命令将指定目录下的所有文件打包成一个压缩文件。<br>文件查找： 使用 find 命令在指定目录下查找包含关键字的所有文件。<br>文件比较： 使用 diff 命令比较两个文件的内容是否相同。<br>文件权限设置： 使用 chmod 命令设置文件的权限。<br>异常处理： 使用 if 语句判断各项操作是否成功，如果失败则输出错误提示信息。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token shebang important">#!/bin/bash</span></pre></td></tr><tr><td data-num="2"></td><td><pre> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 1. 文件备份</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function-name function">backup_file</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token builtin class-name">local</span> <span class="token assign-left variable">file</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$1</span>"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token builtin class-name">local</span> <span class="token assign-left variable">backup_dir</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$2</span>"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token builtin class-name">local</span> <span class="token assign-left variable">backup_file</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$&#123;backup_dir&#125;</span>/<span class="token variable"><span class="token variable">$(</span><span class="token function">basename</span> $<span class="token punctuation">&#123;</span>file<span class="token punctuation">&#125;</span><span class="token variable">)</span></span>.<span class="token variable"><span class="token variable">$(</span><span class="token function">date</span> +%Y-%m-%d_%H-%M-%S<span class="token variable">)</span></span>"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token function">cp</span> <span class="token string">"<span class="token variable">$file</span>"</span> <span class="token string">"<span class="token variable">$backup_file</span>"</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token builtin class-name">echo</span> <span class="token string">"File <span class="token variable">$file</span> backed up to <span class="token variable">$backup_file</span>"</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre> </pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># 2. 文件压缩</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token function-name function">compress_directory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token builtin class-name">local</span> <span class="token assign-left variable">dir</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$1</span>"</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token builtin class-name">local</span> <span class="token assign-left variable">output_file</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$2</span>"</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token function">tar</span> <span class="token parameter variable">-czf</span> <span class="token string">"<span class="token variable">$output_file</span>"</span> <span class="token string">"<span class="token variable">$dir</span>"</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token builtin class-name">echo</span> <span class="token string">"Directory <span class="token variable">$dir</span> compressed to <span class="token variable">$output_file</span>"</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre> </pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment"># 3. 文件查找</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token function-name function">find_files</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token builtin class-name">local</span> <span class="token assign-left variable">directory</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$1</span>"</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token builtin class-name">local</span> <span class="token assign-left variable">keyword</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$2</span>"</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token builtin class-name">echo</span> <span class="token string">"Files containing '<span class="token variable">$keyword</span>' in directory <span class="token variable">$directory</span>:"</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token function">find</span> <span class="token string">"<span class="token variable">$directory</span>"</span> <span class="token parameter variable">-type</span> f <span class="token parameter variable">-name</span> <span class="token string">"*<span class="token variable">$keyword</span>*"</span> <span class="token parameter variable">-exec</span> <span class="token function">ls</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">\</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre> </pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token comment"># 4. 文件比较</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token function-name function">compare_files</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token builtin class-name">local</span> <span class="token assign-left variable">file1</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$1</span>"</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token builtin class-name">local</span> <span class="token assign-left variable">file2</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$2</span>"</span></pre></td></tr><tr><td data-num="32"></td><td><pre>    <span class="token keyword">if</span> <span class="token function">diff</span> <span class="token string">"<span class="token variable">$file1</span>"</span> <span class="token string">"<span class="token variable">$file2</span>"</span> <span class="token operator">></span>/dev/null<span class="token punctuation">;</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token builtin class-name">echo</span> <span class="token string">"Files <span class="token variable">$file1</span> and <span class="token variable">$file2</span> are identical."</span></pre></td></tr><tr><td data-num="34"></td><td><pre>    <span class="token keyword">else</span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token builtin class-name">echo</span> <span class="token string">"Files <span class="token variable">$file1</span> and <span class="token variable">$file2</span> are different."</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token keyword">fi</span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="38"></td><td><pre> </pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token comment"># 5. 文件权限设置</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token function-name function">set_file_permission</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token builtin class-name">local</span> <span class="token assign-left variable">file</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$1</span>"</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token builtin class-name">local</span> <span class="token assign-left variable">permission</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$2</span>"</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token function">chmod</span> <span class="token string">"<span class="token variable">$permission</span>"</span> <span class="token string">"<span class="token variable">$file</span>"</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token builtin class-name">echo</span> <span class="token string">"Permission of file <span class="token variable">$file</span> set to <span class="token variable">$permission</span>"</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td><pre> </pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token comment"># 6. 异常处理</span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token function-name function">handle_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>    <span class="token builtin class-name">local</span> <span class="token assign-left variable">error_message</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$1</span>"</span></pre></td></tr><tr><td data-num="50"></td><td><pre>    <span class="token builtin class-name">echo</span> <span class="token string">"Error: <span class="token variable">$error_message</span>"</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="52"></td><td><pre> </pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token comment"># 主函数</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>    <span class="token builtin class-name">local</span> <span class="token assign-left variable">action</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$1</span>"</span></pre></td></tr><tr><td data-num="56"></td><td><pre>    <span class="token keyword">case</span> <span class="token variable">$action</span> <span class="token keyword">in</span></pre></td></tr><tr><td data-num="57"></td><td><pre>        backup<span class="token punctuation">)</span> backup_file <span class="token string">"<span class="token variable">$2</span>"</span> <span class="token string">"<span class="token variable">$3</span>"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>        compress<span class="token punctuation">)</span> compress_directory <span class="token string">"<span class="token variable">$2</span>"</span> <span class="token string">"<span class="token variable">$3</span>"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>        <span class="token function">find</span><span class="token punctuation">)</span> find_files <span class="token string">"<span class="token variable">$2</span>"</span> <span class="token string">"<span class="token variable">$3</span>"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>        compare<span class="token punctuation">)</span> compare_files <span class="token string">"<span class="token variable">$2</span>"</span> <span class="token string">"<span class="token variable">$3</span>"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>        set_permission<span class="token punctuation">)</span> set_file_permission <span class="token string">"<span class="token variable">$2</span>"</span> <span class="token string">"<span class="token variable">$3</span>"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>        *<span class="token punctuation">)</span> handle_error <span class="token string">"Invalid action: <span class="token variable">$action</span>"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>    <span class="token keyword">esac</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="65"></td><td><pre> </pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token comment"># 调用主函数，并传入参数</span></pre></td></tr><tr><td data-num="67"></td><td><pre>main <span class="token string">"<span class="token variable">$@</span>"</span></pre></td></tr></table></figure><p>如果参数本身包含空格或特殊字符，应该将它们用引号括起来，以便它们被视为单个参数。在脚本内部处理这些参数时，通常也会使用引号来确保参数中的空格和特殊字符被正确处理。</p><p>此外， <code>$#</code>  是一个特殊的变量，它表示传递给脚本的参数总数。 <code>$0</code>  通常被设置为脚本的名称，尽管这可以通过各种方式被改变或覆盖。</p><h4 id="网络管理脚本"><a class="anchor" href="#网络管理脚本">#</a> 网络管理脚本</h4><p><strong>脚本要求</strong>：<br>查看网络连接： 显示当前系统的网络连接状态，包括正在监听的端口和建立的连接。<br>检查网络连通性： 给定一个目标主机和端口，检查当前系统与目标主机的网络连通性。<br>查看网络流量： 显示当前系统的网络流量统计信息，包括接收和发送的数据量。<br>防火墙管理： 提供基本的防火墙管理功能，包括查看防火墙规则、添加规则、删除规则等。<br>异常处理： 当发生异常情况时，及时记录并给出相应提示。</p><p><strong>实现思路</strong>：<br>查看网络连接： 使用 netstat 命令查看当前系统的网络连接状态。<br>检查网络连通性： 使用 nc 命令或 ping 命令检查系统与目标主机的网络连通性。<br>查看网络流量： 使用 ifconfig 命令或 ip 命令查看当前系统的网络接口信息，可以结合 grep 命令筛选需要的信息。<br>防火墙管理： 使用 iptables 命令管理防火墙规则。<br>异常处理： 使用 if 语句判断各项操作是否成功，如果失败则输出错误提示信息。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token shebang important">#!/bin/bash</span></pre></td></tr><tr><td data-num="2"></td><td><pre> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 1. 查看网络连接</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token function-name function">view_network_connections</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token builtin class-name">echo</span> <span class="token string">"Network connections:"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token function">netstat</span> <span class="token parameter variable">-tuln</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 2. 检查网络连通性</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token function-name function">check_network_connectivity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token builtin class-name">local</span> <span class="token assign-left variable">host</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$1</span>"</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token builtin class-name">local</span> <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$2</span>"</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token builtin class-name">echo</span> <span class="token string">"Checking connectivity to <span class="token variable">$host</span>:<span class="token variable">$port</span> ..."</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">if</span> <span class="token function">nc</span> <span class="token parameter variable">-zv</span> <span class="token string">"<span class="token variable">$host</span>"</span> <span class="token string">"<span class="token variable">$port</span>"</span> <span class="token operator">></span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span><span class="token punctuation">;</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token builtin class-name">echo</span> <span class="token string">"Connection to <span class="token variable">$host</span>:<span class="token variable">$port</span> successful."</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">else</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token builtin class-name">echo</span> <span class="token string">"Connection to <span class="token variable">$host</span>:<span class="token variable">$port</span> failed."</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">fi</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre> </pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment"># 3. 查看网络流量</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token function-name function">view_network_traffic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token builtin class-name">echo</span> <span class="token string">"Network traffic:"</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token function">ifconfig</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre> </pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment"># 4. 防火墙管理</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token function-name function">manage_firewall</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token builtin class-name">local</span> <span class="token assign-left variable">action</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$1</span>"</span></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token keyword">case</span> <span class="token variable">$action</span> <span class="token keyword">in</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        view_rules<span class="token punctuation">)</span> iptables <span class="token parameter variable">-L</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        add_rule<span class="token punctuation">)</span> iptables <span class="token parameter variable">-A</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token string">"<span class="token variable">$2</span>"</span> <span class="token parameter variable">-j</span> ACCEPT <span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        delete_rule<span class="token punctuation">)</span> iptables <span class="token parameter variable">-D</span> INPUT <span class="token parameter variable">-p</span> tcp <span class="token parameter variable">--dport</span> <span class="token string">"<span class="token variable">$2</span>"</span> <span class="token parameter variable">-j</span> ACCEPT <span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        *<span class="token punctuation">)</span> <span class="token builtin class-name">echo</span> <span class="token string">"Invalid action: <span class="token variable">$action</span>"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token keyword">esac</span></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre> </pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token comment"># 5. 异常处理</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token function-name function">handle_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token builtin class-name">local</span> <span class="token assign-left variable">error_message</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$1</span>"</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token builtin class-name">echo</span> <span class="token string">"Error: <span class="token variable">$error_message</span>"</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="43"></td><td><pre> </pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token comment"># 主函数</span></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token builtin class-name">local</span> <span class="token assign-left variable">action</span><span class="token operator">=</span><span class="token string">"<span class="token variable">$1</span>"</span></pre></td></tr><tr><td data-num="47"></td><td><pre>    <span class="token keyword">case</span> <span class="token variable">$action</span> <span class="token keyword">in</span></pre></td></tr><tr><td data-num="48"></td><td><pre>        view_connections<span class="token punctuation">)</span> view_network_connections <span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>        check_connectivity<span class="token punctuation">)</span> check_network_connectivity <span class="token string">"<span class="token variable">$2</span>"</span> <span class="token string">"<span class="token variable">$3</span>"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        view_traffic<span class="token punctuation">)</span> view_network_traffic <span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        manage_firewall<span class="token punctuation">)</span> manage_firewall <span class="token string">"<span class="token variable">$2</span>"</span> <span class="token string">"<span class="token variable">$3</span>"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>        *<span class="token punctuation">)</span> handle_error <span class="token string">"Invalid action: <span class="token variable">$action</span>"</span> <span class="token punctuation">;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token keyword">esac</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="55"></td><td><pre> </pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token comment"># 调用主函数，并传入参数</span></pre></td></tr><tr><td data-num="57"></td><td><pre>main <span class="token string">"<span class="token variable">$@</span>"</span></pre></td></tr></table></figure><p>使用</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>./script_name.sh view_connections</pre></td></tr><tr><td data-num="2"></td><td><pre>./script_name.sh check_connectivity <span class="token number">192.168</span>.1.1 <span class="token number">80</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="4"></td><td><pre>./script_name.sh manage_firewall view_rules</pre></td></tr><tr><td data-num="5"></td><td><pre>./script_name.sh manage_firewall add_rule <span class="token number">22</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr></table></figure><p>如果不传入有效的参数，脚本会调用 handle_error 函数并显示错误信息。记得替换 script_name.sh 为你的脚本实际文件名</p><h4 id="定时任务脚本"><a class="anchor" href="#定时任务脚本">#</a> 定时任务脚本</h4><p><strong>脚本要求</strong>：<br>定时执行任务： 按照预定的时间间隔执行指定的任务。<br>任务执行日志： 记录每次任务执行的日志，包括执行时间和执行结果。<br>异常处理： 当任务执行出错时，及时记录并给出相应提示。</p><p><strong>实现思路</strong>：<br>使用 cron 定时任务： 使用 Linux 系统自带的 cron 工具来执行定时任务，cron 支持分钟、小时、日、月、星期等时间单位的定时调度。<br>编写任务脚本： 编写要执行的任务脚本，例如一个 Shell 脚本，确保脚本具有可执行权限。<br>任务执行日志： 在任务脚本中添加记录日志的功能，将执行时间和执行结果输出到指定的日志文件中。<br>异常处理： 在任务脚本中添加异常处理逻辑，例如使用 if 语句判断任务执行结果，如果出错则记录错误信息到日志中。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token shebang important">#!/bin/bash</span></pre></td></tr><tr><td data-num="2"></td><td><pre> </pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 定义任务脚本路径</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token assign-left variable">TASK_SCRIPT</span><span class="token operator">=</span><span class="token string">"/path/to/your/task_script.sh"</span></pre></td></tr><tr><td data-num="5"></td><td><pre> </pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 定义日志文件路径</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token assign-left variable">LOG_FILE</span><span class="token operator">=</span><span class="token string">"/path/to/your/log_file.log"</span></pre></td></tr><tr><td data-num="8"></td><td><pre> </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 执行任务，并记录执行时间和结果到日志文件</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token function-name function">run_task</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token builtin class-name">echo</span> <span class="token string">"Task started at <span class="token variable"><span class="token variable">$(</span><span class="token function">date</span><span class="token variable">)</span></span>"</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$LOG_FILE</span>"</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token keyword">if</span> <span class="token variable">$TASK_SCRIPT</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$LOG_FILE</span>"</span> <span class="token operator"><span class="token file-descriptor important">2</span>></span><span class="token file-descriptor important">&amp;1</span><span class="token punctuation">;</span> <span class="token keyword">then</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token builtin class-name">echo</span> <span class="token string">"Task completed successfully"</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$LOG_FILE</span>"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token keyword">else</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token builtin class-name">echo</span> <span class="token string">"Task failed"</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$LOG_FILE</span>"</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token keyword">fi</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token builtin class-name">echo</span> <span class="token string">"Task ended at <span class="token variable"><span class="token variable">$(</span><span class="token function">date</span><span class="token variable">)</span></span>"</span> <span class="token operator">>></span> <span class="token string">"<span class="token variable">$LOG_FILE</span>"</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre> </pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment"># 主函数</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    run_task</pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre> </pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment"># 调用主函数</span></pre></td></tr><tr><td data-num="26"></td><td><pre>main</pre></td></tr></table></figure><ul><li>编辑 cron 任务列表：执行 crontab -e 命令打开 cron 任务列表文件。</li><li>添加定时任务：在文件中添加一行配置，指定任务执行的时间间隔和要执行的脚本路径。例如，每小时执行一次任务可以添加如下配置：<br><code>0 * * * * /path/to/your/task_scheduler.sh</code></li></ul><h4 id="总结"><a class="anchor" href="#总结">#</a> 总结</h4><ol><li><strong>初始化:</strong> 设置任务脚本路径和日志文件路径。</li><li><strong>执行任务:</strong> 调用 main 函数，进而执行 run_task 函数。</li><li><strong>日志记录:</strong> 记录任务从开始到结束的全部过程，包括时间戳和执行结果。</li><li><strong>结束:</strong> 脚本执行完毕，日志中保留有完整的任务执行信息</li></ol><h3 id="其他自动化方法工具"><a class="anchor" href="#其他自动化方法工具">#</a> 其他自动化方法 / 工具</h3><p>ansible、jenkins、宝塔、jumpserver、ELK</p><h3 id="监控"><a class="anchor" href="#监控">#</a> 监控</h3><p>zabbix、Prometheus、cacti、nagios</p><h3 id="中间件"><a class="anchor" href="#中间件">#</a> 中间件 √</h3><p>这块倒是已经比较了解了， redis、各类 MQ、zookeeper、mongoDB 等</p><h3 id="虚拟化技术"><a class="anchor" href="#虚拟化技术">#</a> 虚拟化技术</h3><p>docker 容器、k8s、rancher</p><p>云平台 openstack，这个好像工作也会用</p><h3 id="大数据"><a class="anchor" href="#大数据">#</a> 大数据</h3><p>hadoop、spark、storm、zookeeper</p><h2 id="额外可能会用到的"><a class="anchor" href="#额外可能会用到的">#</a> 额外可能会用到的</h2><h3 id="python-抓包"><a class="anchor" href="#python-抓包">#</a> Python 抓包</h3><h1 id="思考-2"><a class="anchor" href="#思考-2">#</a> 思考</h1><p>-  API 参考看到好多 rest 风格用 https 进行操作，但在上面的文档有集成的管理平台欸？是给谁用的？</p><p>-  <strong>沙箱？</strong></p><p>-       在服务器上创建的安全隔离环境，用于运行不受信任的或潜在恶意的代码，以防止对服务器的攻击和滥用。用到了虚拟化技术、访问控制技术与防躲避技术。</p><p>-       Q：“在<strong>沙</strong>箱中运行的程序只能访问沙箱给它加载的资源，而不会影响到外部的应用、系统或平台？” 为什么能在沙箱里杀死相应的 SQL 语句？那不就影响了外部的资源？</p><p>-</p><p>-       <strong>容灾处理？</strong></p><p>-       文档中说 “当两个实例搭建了容灾关系后，如果未安装数据库容灾服务，在其中一个实例执行了节点替换，则需要重新刷新容灾信息，可以通过<a href="mk:MSITStore:C:%5CUsers%5CDigital%5CDesktop%5C%E4%BA%91%E6%95%B0%E6%8D%AE%E5%BA%93%20GaussDB%202.23.01.210%20%E4%BA%A7%E5%93%81%E6%96%87%E6%A1%A3(%E5%88%86%E5%B8%83%E5%BC%8F)%2001.chm::/zh-cn_topic_0000001344231456.html"><em>导出容灾配置</em></a>导出对端实例的容灾配置，再通过本功能_将导出的容灾配置导入该实例_，刷新该实例的容灾信息。”</p><p>-       我的理解是，容灾已经生效，节点被替换，还需要重置容灾，但这个容灾信息里不会是原始的容灾节点信息吗，如 ip 等？那不就自己容灾自己，还是全由平台自动分配？得等堡垒机下来后去看下这个配置文件才知道</p><p>-</p><h1 id="扩展学习"><a class="anchor" href="#扩展学习">#</a> 扩展学习</h1><h2 id="关于索引"><a class="anchor" href="#关于索引">#</a> 关于索引</h2><p>-       原来是按照组合索引去匹配最左原则，而不是看字段，假如（a,b,d,c）在一个查询语句中 abcd 都有，并且只有 c 是范围查询（&gt;,&lt;,between,like 等停止匹配的情况）, 那么无论 abcd 什么顺序写 SQL（<strong>=<strong><strong> 和</strong></strong> in**** 可以乱序，优化器会处理</strong>），都是走索引，直到 c。</p><p>-       原理：因为<strong>前一个条件</strong>相同的情况下 <strong>当前条件</strong>才会是<strong>有序的</strong>。当<strong>前一个条件</strong>不同 那么无法保证<strong>当前条件</strong>为有序的 所以索引失效。范围查询就是触发了后一句话。</p><h2 id="io多路复用"><a class="anchor" href="#io多路复用">#</a> IO 多路复用</h2><ol><li>IO 多路复用是一种同步 IO 模型，实现一个线程可以监视多个文件句柄；</li><li>一旦某个文件句柄就绪，就能够通知应用程序进行相应的读写操作；</li><li>没有文件句柄就绪就会阻塞应用程序，交出 CPU。</li></ol><p>BIO 同步阻塞，NIO 加入一个 fds 集合，然后去轮询，CPU 开销大</p><p>而 IO 多路复用采用单线程通过 select/poll/epoll 等系统调用获取 fd 列表，遍历有事件的 fd 进行 accept/recv/send ，使其能支持更多的并发连接请求</p><p><strong>select</strong><br>它仅仅知道了，有 I/O 事件发生了，却并不知道是哪那几个流（可能有一个，多个，甚至全部），我们只能无差别轮询所有流，找出能读出数据，或者写入数据的流，对他们进行操作。所以 select 具有 O (n) 的无差别轮询复杂度，同时处理的流越多，无差别轮询时间就越长。</p><p><strong>Poll</strong></p><p>本质上和 select 没有区别，它将用户传入的数组拷贝到内核空间，然后查询每个 fd 对应的设备状态， 但是它没有最大连接数的限制，原因是它是基于链表来存储的.</p><p><strong>Epoll</strong></p><p>可以理解为 event poll，不同于忙轮询和无差别轮询，epoll 会把哪个流发生了怎样的 I/O 事件通知我们。所以我们说 epoll 实际上是 ** 事件驱动（每个事件关联上 fd）** 的，此时我们对这些流的操作都是有意义的。（复杂度降低到了 O (1)）。所有添加到 epoll 中的事件都会与设备 (网卡) 驱动程序建立回调关系，也就是说，当相应的事件发生时会调用这个回调方法。用红黑树挂载结构体，通过有无判断事件。</p><p><strong>总结</strong></p><p>Select，poll 实现需要自己不断轮询所有 fd 集合，直到设备就绪，期间可能要睡眠和唤醒多次交替。而 epoll 其实也需要调用 epoll_wait 不断轮询就绪链表，期间也可能多次睡眠和唤醒交替，但是它是设备就绪时，调用回调函数，把就绪 fd 放入就绪链表中，并唤醒在 epoll_wait 中进入睡眠的进程。虽然都要睡眠和交替，但是 select 和 poll 在 “醒着” 的时候要遍历整个 fd 集合，而 epoll 在 “醒着” 的时候只要判断一下就绪链表是否为空就行了，这节省了大量的 CPU 时间。这就是回调机制带来的性能提升。<br>select，poll 每次调用都要把 fd 集合从用户态往内核态拷贝一次，并且要把 current 往设备等待队列中挂一次，而 epoll 只要一次拷贝，而且把 current 往等待队列上挂也只挂一次（在 epoll_wait 的开始，注意这里的等待队列并不是设备等待队列，只是一个 epoll 内部定义的等待队列）。这也能节省不少的开销。</p><h2 id="jvm"><a class="anchor" href="#jvm">#</a> JVM</h2><p>新生代（分成 Eden 区、Survivor from 区、Survivor to 区，8：1：1，为了方便标记 - 复制法，触发 minor GC，实际存活的也不会很多）-&gt; 老生代（mGC 后存活的大的放进来，放进来前有个判断，平均放入是否大于现在剩余的，以及是否采取保守策略，来判断是否触发 full GC；小的会有个 age 计数器，到了阈值 {相同年龄的所有对象大小的总和大于 Survivor 空间的一半} 放入）-&gt; 方法区（持久区，class 和 static）</p><p>** 什么时候需要调优？** 系统不稳定，时快时慢（频繁 full GC / 新生代太大，mGC 太久）；内存占用过大（长时间部署，可能 OOM / 多服务部署）；</p><p><strong>解决：还是分配、选择合适的算法、提高内存大小</strong></p><p><strong>1. 选择合适的垃圾回收算法</strong></p><p>根据应用的特性选择合适的 GC 算法：</p><p><strong>吞吐量优先</strong>：使用 Parallel GC（并行 GC）。</p><p><strong>低延迟优先</strong>：使用 CMS GC（并发标记清除 GC）或 G1 GC。</p><p><strong>2. 调整堆内存大小和分代比例</strong></p><p><strong>初始堆大小和最大堆大小</strong>：设置合理的 -Xms 和 -Xmx 参数，避免频繁的堆扩展和收缩。</p><p><strong>新生代和老年代比例</strong>：根据应用的对象生命周期调整新生代和老年代的大小。例如，短生命周期对象多的应用，可以增加新生代的大小。</p><p><strong>3. 调整垃圾回收参数</strong></p><p><strong>GC 日志</strong>：启用 GC 日志（-Xlog:gc*），监控 GC 活动，分析 GC 性能。</p><p><strong>垃圾回收线程数</strong>：调整 GC 线程数（-XX:ParallelGCThreads）以优化 GC 性能。</p><p><strong>4. 调整方法区和元空间</strong></p><p><strong>方法区大小</strong>：对于 JDK 7 及之前，调整永久代大小（-XX:PermSize 和 -XX:MaxPermSize）。</p><p><strong>元空间大小</strong>：对于 JDK 8 及之后，调整元空间大小（-XX:MetaspaceSize 和 -XX:MaxMetaspaceSize）。</p><p><strong>5. 优化应用程序代码</strong></p><p><strong>减少对象创建</strong>：优化代码，减少不必要的对象创建，降低 GC 压力。</p><p><strong>对象池</strong>：使用对象池复用对象，减少内存分配和回收。</p><p><strong>6. 监控和分析</strong></p><p><strong>监控工具</strong>：使用监控工具（如 JVisualVM、Java Mission Control、Prometheus、Grafana）监控 JVM 性能。</p><p><strong>分析工具</strong>：使用分析工具（如 jstat、jmap、jstack）分析 JVM 内存和线程情况，找出性能瓶颈。</p><h2 id="sql"><a class="anchor" href="#sql">#</a> SQL</h2><p><span class="exturl" data-url="aHR0cHM6Ly9jb2Rld2QuY29tL3F1ZXN0aW9uL280ZnpsaXMz">你有哪些 mysql 语句优化的技巧？-codewd</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9jb2Rld2QuY29tL3F1ZXN0aW9uL2x1ZHV0djd1">mysql group by 如何优化？-codewd</span></p><pre><code class="language-SQL">CREATE TABLE `t1` (
  `id` int(11) NOT NULL,
  `a` int(11) DEFAULT NULL,
  `b` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `a` (`a`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

-- 插入示例数据
INSERT INTO t1 (id, a, b)
VALUES (1, 1, 1), (2, 2, 2), (3, 3, 3), ..., (1000, 1000, 1000);

EXPLAIN SELECT id%10 AS m, COUNT(*) AS c FROM t1 GROUP BY m LIMIT 10;
</code></pre><p>执行计划显示：</p><ul><li><code>using index</code> ：使用覆盖索引</li><li><code>using temporary</code> ：使用了内存临时表</li><li><code>using filesort</code> ：使用了排序操作</li></ul><p><code>GROUP BY</code>  的执行过程</p><ol><li><strong>创建内存临时表</strong>：内存表包含两个字段 m 和 c，主键是 m。</li><li><strong>扫描表索引</strong>：扫描表  <code>t1</code>  的索引  <code>a</code> ，取出叶子节点上的  <code>id</code>  值，计算  <code>id%10</code>  的结果。</li><li><strong>插入或更新临时表</strong>：<ul><li>如果临时表中没有主键为  <code>x</code>  的行，插入记录  <code>(x, 1)</code> 。</li><li>如果有主键为  <code>x</code>  的行，将  <code>c</code>  值加 1。</li></ul></li><li><strong>排序和返回结果</strong>：根据字段  <code>m</code>  做排序，返回结果集。</li></ol><p>优化方法：</p><ol><li>添加 order by null，避免自动排序。减去了 filesort</li><li>建立索引，比如新建个列，存查询的信息</li><li>对于大数据量的  <code>GROUP BY</code>  操作，使用  <code>SQL_BIG_RESULT</code>  提示，直接使用磁盘临时表（原本在内存），避免内存不足导致性能下降。</li></ol><h1 id="开发准备"><a class="anchor" href="#开发准备">#</a> 开发准备</h1><p>思考细节，<strong>核心是思考底层怎么处理的</strong></p><ul class="task-list"><li class="task-list-item"><input type="checkbox" id="cbx_0" disabled><label for="cbx_0">SQL 优化，XML 批处理怎么做的，和多个在底层实现有什么区别？</label></li><li class="task-list-item"><input type="checkbox" id="cbx_1" disabled><label for="cbx_1">Mysql 索引</label></li><li class="task-list-item"><input type="checkbox" id="cbx_2" disabled><label for="cbx_2">redis 的 Zsort 是不是对输入的乱序自动排序？MySQL 不会吗？</label></li><li class="task-list-item"><input type="checkbox" id="cbx_3" disabled><label for="cbx_3">redis 缓存怎么实现的？都是读到内存再转过去吗？大量数据怎么办？</label></li><li class="task-list-item"><input type="checkbox" id="cbx_4" disabled><label for="cbx_4">MQ 的细节，怎么保证不丢失，不超卖</label><ul class="task-list"><li class="task-list-item"><input type="checkbox" id="cbx_5" disabled><label for="cbx_5">rabbit 吞吐量小，但社区活跃，功能完备，小公司首选</label></li><li class="task-list-item"><input type="checkbox" id="cbx_6" disabled><label for="cbx_6">kafka 和 rocketMQ 吞吐大，但一个阿里维护，更封装，另一个更精简，更快。更具实际需求。实时日志分析、实时监控和实时推荐系统 选 kafka，金融，消息顺序处理（怎么实现的？全局：设置 topic 下读写队列数量为 1，即 quene 队列只能为同一个；局部：同步发实现发送顺序，一个 queue 实现存储顺序 (MessageQueueSelector)，一个队列由一个线程消费保证消费顺序）</label></li></ul></li><li class="task-list-item"><input type="checkbox" id="cbx_7" disabled><label for="cbx_7">dubbo 实现方案</label></li><li class="task-list-item"><input type="checkbox" id="cbx_8" disabled><label for="cbx_8">Zookeeper 节点处理，最前面的销毁时通知下一个？</label></li><li class="task-list-item"><input type="checkbox" id="cbx_9" disabled><label for="cbx_9">rocketMQ 和 kafuka 技术选型， 差异，一开始说用最新的，但并不是，现在觉得 xxx</label></li><li>分库分表的查询（逻辑完整表，物理分开表。又好似虚拟内存的思想？）<ul><li>都查到本地，通过一些插件 join / 自己 join，有规律的话</li><li>有个分表 flag 表，先找到该用户（通过 id）的信息在哪个表</li><li>再去那个表查具体的信息（可能是：buy_order_id  | user_id | user_guide_id），又找到别的信息的表</li><li>再去查哪个分表，依次拆分使用</li><li>这个过程还可以配合前台的 ajax 异步请求</li></ul></li><li>分库分表的问题<ul><li>上面对于客户而言，值对应一个库 / 表，没问题，但是对于商户 / 管理员可能就要全部查询了，而且有极大浪费</li><li>事务一致性的问题：<ul><li>分布式事务：如 2、3 阶段提交，XA 协议</li><li>最终一致性：不苛求系统的实时一致性，只要在允许的时间段内达到最终一致性即可，可采用事务补偿的方式</li><li>异常处理、死锁检测、TPCC 验证</li></ul></li><li>跨节点 join：<ul><li>冗余：朴素点就是数据的冗余，商户有自己的表库结构</li><li>全局表</li><li>组装</li><li>分片：对应需要关联的表，放在一个数据库</li></ul></li><li>夸节点分页、函数、排序问题？</li><li>迁移和扩容的问题？</li></ul></li></ul><p>发现实际生产中，很多使用 kafufa 处理日志进行备份 / 同步，可能是速度快？</p><ul><li>问题：<ul><li>网络：类似 java 的 Netty。实现了用也是 Reacotr 模型的自己的 RPC 架构，主要分为三个角色<ul><li>Reactor：把 IO 事件分配给对应的 handler 处理</li><li>Acceptor：处理客户端连接事件</li><li>Handler：处理非阻塞的任务</li><li>对于多连接问题用线程池处理，对于连接后阻塞等待数据的问题，多个连接公用一个阻塞对象（IO 多路复用）</li></ul></li><li>磁盘：相比 redis 内存用了磁盘，采用 <code>顺序写</code> 文件，基本减少了磁盘 <code>寻道</code> 和 <code>旋转</code> 的次数。Kafka 中每个分区是一个有序的，不可变的消息序列，新的消息不断追加到 Partition 的末尾（分为多个 Segment，每个 Segment 对应一个物理文件，直接追加写）。<em><strong>原理</strong></em>：Kafka 就是一个 <code>Queue</code> ，FIFO。而 redis 是 hashmap，随机读写。<ul><li>topic 对消息分区，分区日志在物理上按大小分为多个 segment，对文件后缀做了索引映射（快速定位物理地址）</li></ul></li><li>复杂度：普通流程，数据要从系统 - 应用 - socket - 网卡，四步。Kafka 使用到了 <code>mmap</code> 和 <code>sendfile</code> 的方式来实现 <code>零拷贝</code> 。分别对应 Java 的 <code>MappedByteBuffer</code> 和 <code>FileChannel.transferTo</code> （跳过了陷入内核态的开销）</li></ul></li><li>解决方向：<ul><li><strong>并发</strong>：分区并发（Group、partition），内存占用↑、恢复时间↑</li><li><strong>压缩：</strong>（Producer、Broker 和 Consumer 使用相同的压缩算法，在 producer 向 Broker 写入数据，Consumer 向 Broker 读取数据时甚至可以不用解压缩，最终在 Consumer Poll 到消息时才解压，这样节省了大量的网络和磁盘开销。）</li><li><strong>批量</strong></li><li><strong>缓存</strong></li><li><strong>算法</strong><br>最高安全都是保证强一致性，都是确保主从都写成了才算成功。</li></ul></li></ul></div><footer><div class="meta"></div><div class="reward"><button><i class="ic i-heartbeat"></i> Donate</button><p>Give me a cup of [coffee]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.jpg" alt="ZY WeChat Pay"><p>WeChat Pay</p></div></div></div><div id="copyright"><ul><li class="author"><strong>Post author: </strong>ZY <i class="ic i-at"><em>@</em></i>世界上只有一种真正的英雄主义，就是认清了生活的真相后还依然热爱它</li><li class="link"><strong>Post link: </strong><a href="https://zyakmd.github.io/%E9%95%BF%E5%9F%8E%E5%9F%BA%E9%87%91%E5%AE%9E%E4%B9%A0/%E7%B3%BB%E7%BB%9F%E4%BB%BB%E5%8A%A1/%E5%AE%9E%E4%B9%A0%E7%AC%94%E8%AE%B0.html">https://zyakmd.github.io/长城基金实习/系统任务/实习笔记.html</a></li><li class="license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> unless stating additionally.</li></ul></div></footer></article></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%80%E9%80%9A%E7%9A%84%E8%B4%A6%E5%8F%B7-%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.</span> <span class="toc-text">开通的账号、服务</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">2.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day1"><span class="toc-number">3.</span> <span class="toc-text">Day1</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day2"><span class="toc-number">4.</span> <span class="toc-text">Day2</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#gaussdb%E7%BB%84%E4%BB%B6%E5%85%B3%E7%B3%BB"><span class="toc-number">4.1.</span> <span class="toc-text">GaussDB 组件关系</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%9D%E8%80%83"><span class="toc-number">4.1.1.</span> <span class="toc-text">思考</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#gaussdb%E8%BF%90%E7%BB%B4%E5%88%86%E4%BA%AB%E6%96%87%E6%A1%A3%E5%AD%A6%E4%B9%A0"><span class="toc-number">4.2.</span> <span class="toc-text">GaussDB 运维分享文档学习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2"><span class="toc-number">4.2.1.</span> <span class="toc-text">部署</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%90%E8%90%A5%E9%9D%A2"><span class="toc-number">4.2.2.</span> <span class="toc-text">运营面</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A5%E5%B8%B8%E8%BF%90%E7%BB%B4"><span class="toc-number">4.2.3.</span> <span class="toc-text">日常运维</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%85%E6%A0%B8%E5%8D%87%E7%BA%A7"><span class="toc-number">4.2.4.</span> <span class="toc-text">内核升级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#gaussdb%E6%94%B9%E5%90%8D"><span class="toc-number">4.2.5.</span> <span class="toc-text">GaussDB 改名</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%A7%E5%93%81%E6%96%87%E6%A1%A3%E5%88%86%E5%B8%83%E5%BC%8F"><span class="toc-number">4.3.</span> <span class="toc-text">产品文档（分布式）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day3"><span class="toc-number">5.</span> <span class="toc-text">Day3</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%87%E4%BB%BD"><span class="toc-number">5.1.</span> <span class="toc-text">备份</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#get"><span class="toc-number">5.2.</span> <span class="toc-text">Get：</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%AF%E7%94%A8%E7%82%B9"><span class="toc-number">6.</span> <span class="toc-text">可用点</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day4"><span class="toc-number">7.</span> <span class="toc-text">Day4</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day5"><span class="toc-number">8.</span> <span class="toc-text">Day5</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#day6"><span class="toc-number">9.</span> <span class="toc-text">Day6</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#tdsql"><span class="toc-number">9.1.</span> <span class="toc-text">TDSQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dds-mongodb"><span class="toc-number">9.2.</span> <span class="toc-text">DDS、mongoDB</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C"><span class="toc-number">10.</span> <span class="toc-text">工作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AF%8F%E6%97%A5%E6%B1%87%E6%8A%A5"><span class="toc-number">10.1.</span> <span class="toc-text">每日汇报</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AD%A6%E4%B9%A0%E5%88%B0%E7%9A%84"><span class="toc-number">10.1.1.</span> <span class="toc-text">学习到的</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E8%A1%8C%E4%B8%AD%E7%9A%84"><span class="toc-number">10.2.</span> <span class="toc-text">进行中的</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98"><span class="toc-number">10.2.1.</span> <span class="toc-text">问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E7%BB%B4%E7%9F%A5%E8%AF%86%E5%AD%A6%E4%B9%A0"><span class="toc-number">10.3.</span> <span class="toc-text">运维知识学习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AE"><span class="toc-number">10.3.1.</span> <span class="toc-text">协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#shell%E8%84%9A%E6%9C%AC%E8%87%AA%E5%8A%A8%E5%8C%96"><span class="toc-number">10.3.2.</span> <span class="toc-text">Shell 脚本自动化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E7%AE%A1%E7%90%86%E4%B8%8E%E7%BB%B4%E6%8A%A4%E8%84%9A%E6%9C%AC"><span class="toc-number">10.3.2.1.</span> <span class="toc-text">系统管理与维护脚本</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#crontab"><span class="toc-number">10.3.2.1.1.</span> <span class="toc-text">crontab</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#systemctl"><span class="toc-number">10.3.2.1.2.</span> <span class="toc-text">systemctl</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#bash%E4%B8%AD%E7%9A%84%E9%80%BB%E8%BE%91%E5%88%A4%E6%96%AD"><span class="toc-number">10.3.2.1.3.</span> <span class="toc-text">bash 中的逻辑判断</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C%E8%84%9A%E6%9C%AC"><span class="toc-number">10.3.2.2.</span> <span class="toc-text">文件操作脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E7%AE%A1%E7%90%86%E8%84%9A%E6%9C%AC"><span class="toc-number">10.3.2.3.</span> <span class="toc-text">网络管理脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E8%84%9A%E6%9C%AC"><span class="toc-number">10.3.2.4.</span> <span class="toc-text">定时任务脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">10.3.2.5.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E8%87%AA%E5%8A%A8%E5%8C%96%E6%96%B9%E6%B3%95%E5%B7%A5%E5%85%B7"><span class="toc-number">10.3.3.</span> <span class="toc-text">其他自动化方法 &#x2F; 工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9B%91%E6%8E%A7"><span class="toc-number">10.3.4.</span> <span class="toc-text">监控</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-number">10.3.5.</span> <span class="toc-text">中间件 √</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF"><span class="toc-number">10.3.6.</span> <span class="toc-text">虚拟化技术</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%A7%E6%95%B0%E6%8D%AE"><span class="toc-number">10.3.7.</span> <span class="toc-text">大数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A2%9D%E5%A4%96%E5%8F%AF%E8%83%BD%E4%BC%9A%E7%94%A8%E5%88%B0%E7%9A%84"><span class="toc-number">10.4.</span> <span class="toc-text">额外可能会用到的</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#python-%E6%8A%93%E5%8C%85"><span class="toc-number">10.4.1.</span> <span class="toc-text">Python 抓包</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%80%9D%E8%80%83-2"><span class="toc-number">11.</span> <span class="toc-text">思考</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%89%A9%E5%B1%95%E5%AD%A6%E4%B9%A0"><span class="toc-number">12.</span> <span class="toc-text">扩展学习</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E7%B4%A2%E5%BC%95"><span class="toc-number">12.1.</span> <span class="toc-text">关于索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#io%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8"><span class="toc-number">12.2.</span> <span class="toc-text">IO 多路复用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#jvm"><span class="toc-number">12.3.</span> <span class="toc-text">JVM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sql"><span class="toc-number">12.4.</span> <span class="toc-text">SQL</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%BC%80%E5%8F%91%E5%87%86%E5%A4%87"><span class="toc-number">13.</span> <span class="toc-text">开发准备</span></a></li></ol></div><div class="related panel pjax" data-title="Related"></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="ZY" data-src="/images/avatar.jpg"><p class="name" itemprop="name">ZY</p><div class="description" itemprop="description">行到水穷处，坐看云起时</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">25</span> <span class="name">posts</span></a></div><div class="item categories"><a href="/categories/"><span class="count">6</span> <span class="name">categories</span></a></div><div class="item tags"><a href="/tags/"><span class="count">6</span> <span class="name">tags</span></a></div></nav><div class="social"><a href="https://github.com/zyakmd" title="https:&#x2F;&#x2F;github.com&#x2F;zyakmd" class="item github" rel="noopener" target="_blank"><i class="ic i-github"></i></a></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>Home</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>Posts</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>Archives</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>Categories</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>Tags</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>Random Posts</h2><ul><li class="item"><div class="breadcrumb"></div><span><a href="/2024/03/29/Docker/" title="Docker">Docker</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/spring%E5%A4%8D%E4%B9%A0/" title="In spring复习">spring复习</a></div><span><a href="/2024/03/15/spring%E5%A4%8D%E4%B9%A0/Spring%20MVC/" title="Spring MVC">Spring MVC</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/03/21/Java%E7%9F%A5%E8%AF%86/Java%E7%AC%94%E8%AE%B0/" title="Java笔记">Java笔记</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2024/05/09/%E8%99%9A%E6%8B%9F%E4%B8%96%E7%95%8Ctricks/Windows%E7%9B%B8%E5%85%B3/" title="Windows相关">Windows相关</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/RPC/" title="In RPC">RPC</a></div><span><a href="/2024/04/01/RPC%E9%A1%B9%E7%9B%AE/" title="RPC项目">RPC项目</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/spring%E5%A4%8D%E4%B9%A0/" title="In spring复习">spring复习</a></div><span><a href="/2024/03/17/spring%E5%A4%8D%E4%B9%A0/SSM%E6%95%B4%E5%90%88/" title="SSM整合">SSM整合</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/hexo%E4%BD%BF%E7%94%A8/" title="In hexo使用">hexo使用</a></div><span><a href="/2024/03/09/hexo%E4%BD%BF%E7%94%A8/%E7%95%8C%E9%9D%A2%E7%9B%B8%E5%85%B3/" title="界面相关">界面相关</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/spring%E5%A4%8D%E4%B9%A0/" title="In spring复习">spring复习</a></div><span><a href="/2024/03/18/spring%E5%A4%8D%E4%B9%A0/Maven/" title="Maven">Maven</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/hexo%E4%BD%BF%E7%94%A8/" title="In hexo使用">hexo使用</a></div><span><a href="/2024/03/07/hexo%E4%BD%BF%E7%94%A8/%E5%9C%A8obisidian%E4%B8%8A%E4%BD%BF%E7%94%A8/" title="在obisidian上使用">在obisidian上使用</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/spring%E5%A4%8D%E4%B9%A0/" title="In spring复习">spring复习</a></div><span><a href="/2024/03/20/spring%E5%A4%8D%E4%B9%A0/MyBatis%20Plus/" title="MyBatis Plus">MyBatis Plus</a></span></li></ul></div></div><div class="status"><div class="copyright">&copy; 2023 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-"></i> </span><span class="author" itemprop="copyrightHolder">ZY @ ZY Blog</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="Symbols count total">577k words</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="Reading time total">8:44</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"长城基金实习/系统任务/实习笔记",favicon:{show:"（●´3｀●）Goooood",hide:"(´Д｀)Booooom"},search:{placeholder:"Search for Posts",empty:"We didn't find any results for the search: ${query}",stats:"${hits} results found in ${time} ms"},valine:!0,fancybox:!0,copyright:'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({pluginRootPath:"live2dw/",pluginJsPath:"lib/",pluginModelPath:"assets/",tagMode:!1,debug:!1,model:{jsonPath:"/live2dw/assets/hijiki.model.json"},display:{position:"left",width:150,height:300},mobile:{show:!0},log:!1})</script></body></html><!-- rebuild by hrmmi -->